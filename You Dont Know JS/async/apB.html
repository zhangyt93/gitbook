
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>附录B · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="apC.html" />
    
    
    <link rel="prev" href="apA.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../preface.html">
            
                <a href="../preface.html">
            
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../up/">
            
                <a href="../up/">
            
                    
                    入门与进阶(up & going)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../up/toc.html">
            
                <a href="../up/toc.html">
            
                    
                    目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../up/foreword.html">
            
                <a href="../up/foreword.html">
            
                    
                    序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../up/ch1.html">
            
                <a href="../up/ch1.html">
            
                    
                    第一章：进入编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../up/ch2.html">
            
                <a href="../up/ch2.html">
            
                    
                    第二章：进入JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../up/ch3.html">
            
                <a href="../up/ch3.html">
            
                    
                    第三章：进入YDKJS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../up/apA.html">
            
                <a href="../up/apA.html">
            
                    
                    附录A
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../scope/">
            
                <a href="../scope/">
            
                    
                    作用域与闭包(scope & closures)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../scope/toc.html">
            
                <a href="../scope/toc.html">
            
                    
                    目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../scope/ch1.html">
            
                <a href="../scope/ch1.html">
            
                    
                    第一章：什么是作用域？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../scope/ch2.html">
            
                <a href="../scope/ch2.html">
            
                    
                    第二章：词法作用域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../scope/ch3.html">
            
                <a href="../scope/ch3.html">
            
                    
                    第三章：函数与块儿作用域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../scope/ch4.html">
            
                <a href="../scope/ch4.html">
            
                    
                    第四章：提升
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../scope/ch5.html">
            
                <a href="../scope/ch5.html">
            
                    
                    第五章：作用域闭包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../scope/apA.html">
            
                <a href="../scope/apA.html">
            
                    
                    附录A
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../scope/apB.html">
            
                <a href="../scope/apB.html">
            
                    
                    附录B
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../scope/apC.html">
            
                <a href="../scope/apC.html">
            
                    
                    附录C
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../scope/apD.html">
            
                <a href="../scope/apD.html">
            
                    
                    附录D
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../this/">
            
                <a href="../this/">
            
                    
                    this与对象原型(this & object prototypes)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../this/toc.html">
            
                <a href="../this/toc.html">
            
                    
                    目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../this/foreword.html">
            
                <a href="../this/foreword.html">
            
                    
                    序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../this/ch1.html">
            
                <a href="../this/ch1.html">
            
                    
                    第一章: this是什么？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../this/ch2.html">
            
                <a href="../this/ch2.html">
            
                    
                    第二章: this豁然开朗！
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../this/ch3.html">
            
                <a href="../this/ch3.html">
            
                    
                    第三章: 对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../this/ch4.html">
            
                <a href="../this/ch4.html">
            
                    
                    第四章: 混合（淆）“类”的对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../this/ch5.html">
            
                <a href="../this/ch5.html">
            
                    
                    第五章: 原型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../this/ch6.html">
            
                <a href="../this/ch6.html">
            
                    
                    第六章: 行为委托
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../this/apA.html">
            
                <a href="../this/apA.html">
            
                    
                    附录A
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../this/apB.html">
            
                <a href="../this/apB.html">
            
                    
                    附录B
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../types/">
            
                <a href="../types/">
            
                    
                    类型与文法(types & grammar)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../types/toc.html">
            
                <a href="../types/toc.html">
            
                    
                    目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../types/foreword.html">
            
                <a href="../types/foreword.html">
            
                    
                    序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../types/ch1.html">
            
                <a href="../types/ch1.html">
            
                    
                    第一章：类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../types/ch2.html">
            
                <a href="../types/ch2.html">
            
                    
                    第二章：值
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../types/ch3.html">
            
                <a href="../types/ch3.html">
            
                    
                    第三章：原生类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../types/ch4.html">
            
                <a href="../types/ch4.html">
            
                    
                    第四章：强制转换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../types/ch5.html">
            
                <a href="../types/ch5.html">
            
                    
                    第五章：文法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../types/apA.html">
            
                <a href="../types/apA.html">
            
                    
                    附录A
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../types/apB.html">
            
                <a href="../types/apB.html">
            
                    
                    附录B
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="./">
            
                <a href="./">
            
                    
                    异步与性能(async & performance)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="toc.html">
            
                <a href="toc.html">
            
                    
                    目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="foreword.html">
            
                <a href="foreword.html">
            
                    
                    序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="ch1.html">
            
                <a href="ch1.html">
            
                    
                    第一章: 异步:现在与稍后
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="ch2.html">
            
                <a href="ch2.html">
            
                    
                    第二章: 回调
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="ch3.html">
            
                <a href="ch3.html">
            
                    
                    第三章: Promise
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="ch4.html">
            
                <a href="ch4.html">
            
                    
                    第四章: Generator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="ch5.html">
            
                <a href="ch5.html">
            
                    
                    第五章: 程序性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="ch6.html">
            
                <a href="ch6.html">
            
                    
                    第六章: 基准分析与调优
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="apA.html">
            
                <a href="apA.html">
            
                    
                    附录A
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7.10" data-path="apB.html">
            
                <a href="apB.html">
            
                    
                    附录B
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="apC.html">
            
                <a href="apC.html">
            
                    
                    附录C
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../es6/">
            
                <a href="../es6/">
            
                    
                    ES6与未来(es6 & beyond)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../es6/toc.html">
            
                <a href="../es6/toc.html">
            
                    
                    目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../es6/foreword.html">
            
                <a href="../es6/foreword.html">
            
                    
                    序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../es6/ch1.html">
            
                <a href="../es6/ch1.html">
            
                    
                    第一章：ES？现在与未来
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../es6/ch2.html">
            
                <a href="../es6/ch2.html">
            
                    
                    第二章：语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../es6/ch3.html">
            
                <a href="../es6/ch3.html">
            
                    
                    第三章：组织
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../es6/ch4.html">
            
                <a href="../es6/ch4.html">
            
                    
                    第四章：异步流程控制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../es6/ch5.html">
            
                <a href="../es6/ch5.html">
            
                    
                    第五章：集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.8" data-path="../es6/ch6.html">
            
                <a href="../es6/ch6.html">
            
                    
                    第六章：新增API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9" data-path="../es6/ch7.html">
            
                <a href="../es6/ch7.html">
            
                    
                    第七章：元编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.10" data-path="../es6/ch8.html">
            
                <a href="../es6/ch8.html">
            
                    
                    第八章：ES6以后
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.11" data-path="../es6/apA.html">
            
                <a href="../es6/apA.html">
            
                    
                    附录A
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >附录B</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x4F60;&#x4E0D;&#x61C2;js-&#x5F02;&#x6B65;&#x4E0E;&#x6027;&#x80FD;">&#x4F60;&#x4E0D;&#x61C2;JS: &#x5F02;&#x6B65;&#x4E0E;&#x6027;&#x80FD;</h1>
<h1 id="&#x9644;&#x5F55;b-&#x9AD8;&#x7EA7;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;">&#x9644;&#x5F55;B: &#x9AD8;&#x7EA7;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;</h1>
<p>&#x4E3A;&#x4E86;&#x4E86;&#x89E3;&#x4E3B;&#x8981;&#x57FA;&#x4E8E; Promise &#x4E0E; Generator &#x7684;&#x9762;&#x5411;&#x5E8F;&#x5217;&#x5F02;&#x6B65;&#x6D41;&#x7A0B;&#x63A7;&#x5236;&#xFF0C;&#x9644;&#x5F55;A&#x4ECB;&#x7ECD;&#x4E86; <em>asynquence</em> &#x5E93;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C06;&#x8981;&#x63A2;&#x7D22;&#x5176;&#x4ED6;&#x5EFA;&#x7ACB;&#x5728;&#x65E2;&#x5B58;&#x7406;&#x89E3;&#x4E0E;&#x529F;&#x80FD;&#x4E4B;&#x4E0A;&#x7684;&#x9AD8;&#x7EA7;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#xFF0C;&#x5E76;&#x770B;&#x770B; <em>asynquence</em> &#x662F;&#x5982;&#x4F55;&#x5728;&#x4E0D;&#x9700;&#x8981;&#x8BB8;&#x591A;&#x5206;&#x79BB;&#x7684;&#x5E93;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F7F;&#x5F97;&#x8FD9;&#x4E9B;&#x7CBE;&#x5DE7;&#x7684;&#x5F02;&#x6B65;&#x6280;&#x672F;&#x4E0E;&#x6211;&#x4EEC;&#x7684;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x6DF7;&#x5408;&#x4E0E;&#x5339;&#x914D;&#x7684;&#x3002;</p>
<h2 id="&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;">&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;</h2>
<p>&#x6211;&#x4EEC;&#x5728;&#x524D;&#x4E00;&#x7BC7;&#x9644;&#x5F55;&#x4E2D;&#x4ECB;&#x7ECD;&#x8FC7; <em>asynquence</em> &#x7684;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x66F4;&#x52A0;&#x8BE6;&#x7EC6;&#x5730;&#x91CD;&#x6E29;&#x5B83;&#x4EEC;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x590D;&#x4E60;&#xFF0C;&#x56DE;&#x5FC6;&#x4E00;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> domready = ASQ.iterable();

<span class="hljs-comment">// ..</span>

domready.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-comment">// DOM &#x51C6;&#x5907;&#x597D;&#x4E86;</span>
} );

<span class="hljs-comment">// ..</span>

<span class="hljs-built_in">document</span>.addEventListener( <span class="hljs-string">&quot;DOMContentLoaded&quot;</span>, domready.next );
</code></pre>
<p>&#x73B0;&#x5728;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x5C06;&#x4E00;&#x4E2A;&#x591A;&#x6B65;&#x9AA4;&#x5E8F;&#x5217;&#x5B9A;&#x4E49;&#x4E3A;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> steps = ASQ.iterable();

steps
.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP1</span>(<span class="hljs-params">x</span>)</span>{
    <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>;
} )
.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP2</span>(<span class="hljs-params">x</span>)</span>{
    <span class="hljs-keyword">return</span> x + <span class="hljs-number">3</span>;
} )
.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP3</span>(<span class="hljs-params">x</span>)</span>{
    <span class="hljs-keyword">return</span> x * <span class="hljs-number">4</span>;
} );

steps.next( <span class="hljs-number">8</span> ).value;    <span class="hljs-comment">// 16</span>
steps.next( <span class="hljs-number">16</span> ).value;    <span class="hljs-comment">// 19</span>
steps.next( <span class="hljs-number">19</span> ).value;    <span class="hljs-comment">// 76</span>
steps.next().done;        <span class="hljs-comment">// true</span>
</code></pre>
<p>&#x5982;&#x4F60;&#x6240;&#x89C1;&#xFF0C;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x662F;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x517C;&#x5BB9;&#x7684; <em>iterator</em>&#xFF08;&#x89C1;&#x7B2C;&#x56DB;&#x7AE0;&#xFF09;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5C31;&#x50CF;&#x4E00;&#x4E2A; generator&#xFF08;&#x6216;&#x5176;&#x4ED6;&#x4EFB;&#x4F55; <em>&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;</em>&#xFF09;&#x90A3;&#x6837;&#xFF0C;&#x5B83;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;ES6<code>for..of</code>&#x5FAA;&#x73AF;&#x8FDB;&#x884C;&#x8FED;&#x4EE3;&#x7684;&#xFF0C;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> steps = ASQ.iterable();

steps
.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP1</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>; } )
.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP2</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>; } )
.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP3</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">6</span>; } )
.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP4</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">8</span>; } )
.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP5</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">10</span>; } );

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> v <span class="hljs-keyword">of</span> steps) {
    <span class="hljs-built_in">console</span>.log( v );
}
<span class="hljs-comment">// 2 4 6 8 10</span>
</code></pre>
<p>&#x9664;&#x4E86;&#x5728;&#x524D;&#x4E00;&#x7BC7;&#x9644;&#x5F55;&#x4E2D;&#x5C55;&#x793A;&#x7684;&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x7684;&#x4F8B;&#x5B50;&#x4E4B;&#x5916;&#xFF0C;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x7684;&#x6709;&#x8DA3;&#x4E4B;&#x5904;&#x8FD8;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5B9E;&#x8D28;&#x4E0A;&#x53EF;&#x4EE5;&#x88AB;&#x89C6;&#x4E3A; generator &#x548C; Promise &#x94FE;&#x7684;&#x66FF;&#x4EE3;&#x54C1;&#xFF0C;&#x4F46;&#x5177;&#x5907;&#x66F4;&#x591A;&#x7075;&#x6D3B;&#x6027;&#x3002;</p>
<p>&#x8003;&#x8651;&#x4E00;&#x4E2A;&#x591A;Ajax&#x8BF7;&#x6C42;&#x7684;&#x4F8B;&#x5B50; &#x2014;&#x2014; &#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5728;&#x7B2C;&#x4E09;&#x7AE0;&#x548C;&#x7B2C;&#x56DB;&#x7AE0;&#x4E2D;&#x770B;&#x5230;&#x8FC7;&#x540C;&#x6837;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x5206;&#x522B;&#x4F7F;&#x7528;&#x4E00;&#x4E2A; Promise &#x94FE;&#x548C;&#x4E00;&#x4E2A; generator &#x2014;&#x2014; &#x8868;&#x8FBE;&#x4E3A;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-comment">// &#x517C;&#x5BB9;&#x5E8F;&#x5217;&#x7684; ajax</span>
<span class="hljs-keyword">var</span> request = ASQ.wrap( ajax );

ASQ( <span class="hljs-string">&quot;http://some.url.1&quot;</span> )
.runner(
    ASQ.iterable()

    .then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP1</span>(<span class="hljs-params">token</span>)</span>{
        <span class="hljs-keyword">var</span> url = token.messages[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">return</span> request( url );
    } )

    .then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP2</span>(<span class="hljs-params">resp</span>)</span>{
        <span class="hljs-keyword">return</span> ASQ().gate(
            request( <span class="hljs-string">&quot;http://some.url.2/?v=&quot;</span> + resp ),
            request( <span class="hljs-string">&quot;http://some.url.3/?v=&quot;</span> + resp )
        );
    } )

    .then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP3</span>(<span class="hljs-params">r1,r2</span>)</span>{ <span class="hljs-keyword">return</span> r1 + r2; } )
)
.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>)</span>{
    <span class="hljs-built_in">console</span>.log( msg );
} );
</code></pre>
<p>&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x8868;&#x8FBE;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x987A;&#x5E8F;&#x7684;&#xFF08;&#x540C;&#x6B65;&#x7684;&#x6216;&#x5F02;&#x6B65;&#x7684;&#xFF09;&#x6B65;&#x9AA4;&#xFF0C;&#x5B83;&#x770B;&#x8D77;&#x6765;&#x4E0E;&#x4E00;&#x4E2A; Promise &#x94FE;&#x6781;&#x5176;&#x76F8;&#x4F3C; &#x2014;&#x2014; &#x6362;&#x8A00;&#x4E4B;&#xFF0C;&#x5B83;&#x8981;&#x6BD4;&#x5355;&#x7EAF;&#x5D4C;&#x5957;&#x7684;&#x56DE;&#x8C03;&#x770B;&#x8D77;&#x6765;&#x5E72;&#x51C0;&#x7684;&#x591A;&#xFF0C;&#x4F46;&#x6CA1;&#x6709; generator &#x7684;&#x57FA;&#x4E8E;<code>yield</code>&#x7684;&#x987A;&#x5E8F;&#x5316;&#x8BED;&#x6CD5;&#x90A3;&#x4E48;&#x597D;&#x3002;</p>
<p>&#x4F46;&#x6211;&#x4EEC;&#x5C06;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x4F20;&#x5165;<code>ASQ#runner(..)</code>&#xFF0C;&#x5B83;&#x5C06;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x50CF;&#x4E00;&#x4E2A; generator &#x90A3;&#x6837;&#x8FD0;&#x884C;&#x81F3;&#x5B8C;&#x6210;&#x3002;&#x7531;&#x4E8E;&#x51E0;&#x4E2A;&#x539F;&#x56E0;&#xFF0C;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x7684;&#x884C;&#x4E3A;&#x5B9E;&#x8D28;&#x4E0A;&#x4E0E;&#x4E00;&#x4E2A; generator &#x76F8;&#x540C;&#x7684;&#x4E8B;&#x5B9E;&#x662F;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#xFF1A;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x5BF9;&#x4E8E;ES6 generator &#x7684;&#x7279;&#x5B9A;&#x5B50;&#x96C6;&#x6765;&#x8BF4;&#xFF0C;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;&#x662F;&#x5B83;&#x7684;&#x4E00;&#x79CD;&#x524D;ES6&#x7B49;&#x4EF7;&#x7269;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x4F60;&#x65E2;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7F16;&#x5199;&#x5B83;&#x4EEC;&#xFF08;&#x4E3A;&#x4E86;&#x5728;&#x4EFB;&#x4F55;&#x5730;&#x65B9;&#x90FD;&#x80FD;&#x8FD0;&#x884C;&#xFF09;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7F16;&#x5199;ES6 generator &#x5E76;&#x5C06;&#x5B83;&#x4EEC;&#x8F6C;&#x8BD1;/&#x8F6C;&#x6362;&#x6210;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#xFF08;&#x6216;&#x8005; Promise &#x94FE;&#xFF01;&#xFF09;&#x3002;</p>
<p>&#x5C06;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x8FD0;&#x884C;&#x81F3;&#x5B8C;&#x6210;&#x7684; generator &#x8003;&#x8651;&#x4E3A;&#x4E00;&#x4E2A; Promise &#x94FE;&#x7684;&#x8BED;&#x6CD5;&#x7CD6;&#xFF0C;&#x662F;&#x5BF9;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x540C;&#x6784;&#x5173;&#x7CFB;&#x7684;&#x4E00;&#x79CD;&#x91CD;&#x8981;&#x8BA4;&#x8BC6;&#x3002;</p>
<p>&#x5728;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x6BB5;&#x672C;&#x53EF;&#x4EE5;&#x7528; <em>asynquence</em> &#x8868;&#x8FBE;&#x4E3A;&#xFF1A;</p>
<pre><code class="lang-js">ASQ( <span class="hljs-string">&quot;http://some.url.1&quot;</span> )
.seq( <span class="hljs-comment">/*STEP 1*/</span> request )
.seq( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP2</span>(<span class="hljs-params">resp</span>)</span>{
    <span class="hljs-keyword">return</span> ASQ().gate(
        request( <span class="hljs-string">&quot;http://some.url.2/?v=&quot;</span> + resp ),
        request( <span class="hljs-string">&quot;http://some.url.3/?v=&quot;</span> + resp )
    );
} )
.val( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP3</span>(<span class="hljs-params">r1,r2</span>)</span>{ <span class="hljs-keyword">return</span> r1 + r2; } )
.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>)</span>{
    <span class="hljs-built_in">console</span>.log( msg );
} );
</code></pre>
<p>&#x8FDB;&#x4E00;&#x6B65;&#xFF0C;&#x6B65;&#x9AA4;2&#x672C;&#x53EF;&#x4EE5;&#x88AB;&#x8868;&#x8FBE;&#x4E3A;&#xFF1A;</p>
<pre><code class="lang-js">.gate(
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP2a</span>(<span class="hljs-params">done,resp</span>) </span>{
        request( <span class="hljs-string">&quot;http://some.url.2/?v=&quot;</span> + resp )
        .pipe( done );
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP2b</span>(<span class="hljs-params">done,resp</span>) </span>{
        request( <span class="hljs-string">&quot;http://some.url.3/?v=&quot;</span> + resp )
        .pipe( done );
    }
)
</code></pre>
<p>&#x90A3;&#x4E48;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x7B80;&#x5355;/&#x6241;&#x5E73;&#x7684; <em>asyquence</em> &#x94FE;&#x770B;&#x8D77;&#x6765;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x5DE5;&#x4F5C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F88;&#x9EBB;&#x70E6;&#x5730;&#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x63A7;&#x5236;&#x6D41;&#x5728;&#x4E00;&#x4E2A;<code>ASQ#runner(..)</code>&#x6B65;&#x9AA4;&#x4E2D;&#x8868;&#x8FBE;&#x4E3A;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x5462;&#xFF1F;</p>
<p>&#x56E0;&#x4E3A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x7684;&#x5F62;&#x5F0F;&#x6709;&#x4E00;&#x79CD;&#x91CD;&#x8981;&#x7684;&#x6280;&#x5DE7;&#x53EF;&#x4EE5;&#x7ED9;&#x6211;&#x4EEC;&#x66F4;&#x591A;&#x7684;&#x529B;&#x91CF;&#x3002;&#x7EE7;&#x7EED;&#x8BFB;&#x3002;</p>
<h3 id="&#x6269;&#x5C55;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;">&#x6269;&#x5C55;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;</h3>
<p>Generator&#xFF0C;&#x666E;&#x901A;&#x7684; <em>asynquence</em> &#x5E8F;&#x5217;&#xFF0C;&#x548C; Promise &#x94FE;&#xFF0C;&#x90FD;&#x662F;&#x88AB; <strong>&#x6025;&#x5207;&#x6C42;&#x503C;</strong> &#x7684; &#x2014;&#x2014; &#x63A7;&#x5236;&#x6D41;&#x7A0B;&#x6700;&#x521D;&#x8981;&#x8868;&#x8FBE;&#x7684;&#x7684;&#x5185;&#x5BB9; <em>&#x5C31;&#x662F;</em> &#x7D27;&#x8DDF;&#x5728;&#x540E;&#x9762;&#x7684;&#x56FA;&#x5B9A;&#x6D41;&#x7A0B;&#x3002;</p>
<p>&#x7136;&#x800C;&#xFF0C;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x662F; <strong>&#x61D2;&#x60F0;&#x6C42;&#x503C;</strong> &#x7684;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5728;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x6267;&#x884C;&#x671F;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&#x66F4;&#x591A;&#x7684;&#x6B65;&#x9AA4;&#x6269;&#x5C55;&#x8FD9;&#x4E2A;&#x5E8F;&#x5217;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong> &#x4F60;&#x53EA;&#x80FD;&#x5728;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x7684;&#x672B;&#x5C3E;&#x8FDE;&#x63A5;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;&#x5E8F;&#x5217;&#x7684;&#x4E2D;&#x95F4;&#x63D2;&#x5165;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x719F;&#x6089;&#x8FD9;&#x79CD;&#x80FD;&#x529B;&#xFF0C;&#x9996;&#x5148;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF08;&#x540C;&#x6B65;&#xFF09;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">double</span>(<span class="hljs-params">x</span>) </span>{
    x *= <span class="hljs-number">2</span>;

    <span class="hljs-comment">// &#x6211;&#x4EEC;&#x5E94;&#x5F53;&#x7EE7;&#x7EED;&#x6269;&#x5C55;&#x5417;&#xFF1F;</span>
    <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">500</span>) {
        isq.then( double );
    }

    <span class="hljs-keyword">return</span> x;
}

<span class="hljs-comment">// &#x5EFA;&#x7ACB;&#x5355;&#x6B65;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;</span>
<span class="hljs-keyword">var</span> isq = ASQ.iterable().then( double );

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> v = <span class="hljs-number">10</span>, ret;
    (ret = isq.next( v )) &amp;&amp; !ret.done;
) {
    v = ret.value;
    <span class="hljs-built_in">console</span>.log( v );
}
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x5F00;&#x59CB;&#x65F6;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x6B65;&#x9AA4;&#xFF08;<code>isq.then(double)</code>&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x5E8F;&#x5217;&#x4F1A;&#x5728;&#x7279;&#x5B9A;&#x6761;&#x4EF6;&#x4E0B;&#xFF08;<code>x &lt; 500</code>&#xFF09;&#x6301;&#x7EED;&#x6269;&#x5C55;&#x81EA;&#x5DF1;&#x3002;<em>asynquence</em> &#x5E8F;&#x5217;&#x548C; Promise &#x94FE;&#x5728;&#x6280;&#x672F;&#x4E0A;&#x90FD; <em>&#x53EF;&#x4EE5;</em> &#x505A;&#x76F8;&#x4F3C;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x5C06;&#x770B;&#x5230;&#x5B83;&#x4EEC;&#x7684;&#x8FD9;&#x79CD;&#x80FD;&#x529B;&#x4E0D;&#x8DB3;&#x7684;&#x4E00;&#x4E9B;&#x539F;&#x56E0;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x610F;&#x4E49;&#x4E0D;&#x5927;&#xFF0C;&#x800C;&#x4E14;&#x672C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A; generator &#x4E2D;&#x7684;<code>while</code>&#x5FAA;&#x73AF;&#x6765;&#x8868;&#x8FBE;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C06;&#x8003;&#x8651;&#x66F4;&#x7CBE;&#x5DE7;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x68C0;&#x67E5;&#x4E00;&#x4E2A;Ajax&#x8BF7;&#x6C42;&#x7684;&#x5E94;&#x7B54;&#xFF0C;&#x770B;&#x5B83;&#x662F;&#x5426;&#x6307;&#x793A;&#x9700;&#x8981;&#x66F4;&#x591A;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x6761;&#x4EF6;&#x6027;&#x5730;&#x5411;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x63D2;&#x5165;&#x66F4;&#x591A;&#x7684;&#x6B65;&#x9AA4;&#x6765;&#x53D1;&#x8D77;&#x66F4;&#x591A;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x6216;&#x8005;&#x4F60;&#x53EF;&#x4EE5;&#x6761;&#x4EF6;&#x6027;&#x5730;&#x5728;Ajax&#x5904;&#x7406;&#x5668;&#x7684;&#x672B;&#x5C3E;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x683C;&#x5F0F;&#x5316;&#x6B65;&#x9AA4;&#x3002;</p>
<p>&#x8003;&#x8651;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> steps = ASQ.iterable()

.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP1</span>(<span class="hljs-params">token</span>)</span>{
    <span class="hljs-keyword">var</span> url = token.messages[<span class="hljs-number">0</span>].url;

    <span class="hljs-comment">// &#x6709;&#x989D;&#x5916;&#x7684;&#x683C;&#x5F0F;&#x5316;&#x6B65;&#x9AA4;&#x88AB;&#x63D0;&#x4F9B;&#x5417;&#xFF1F;</span>
    <span class="hljs-keyword">if</span> (token.messages[<span class="hljs-number">0</span>].format) {
        steps.then( token.messages[<span class="hljs-number">0</span>].format );
    }

    <span class="hljs-keyword">return</span> request( url );
} )

.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP2</span>(<span class="hljs-params">resp</span>)</span>{
    <span class="hljs-comment">// &#x8981;&#x4E3A;&#x5E8F;&#x5217;&#x589E;&#x52A0;&#x53E6;&#x4E00;&#x4E2A;Ajax&#x8BF7;&#x6C42;&#x5417;&#xFF1F;</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/x1/</span>.test( resp )) {
        steps.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP5</span>(<span class="hljs-params">text</span>)</span>{
            <span class="hljs-keyword">return</span> request(
                <span class="hljs-string">&quot;http://some.url.4/?v=&quot;</span> + text
            );
        } );
    }

    <span class="hljs-keyword">return</span> ASQ().gate(
        request( <span class="hljs-string">&quot;http://some.url.2/?v=&quot;</span> + resp ),
        request( <span class="hljs-string">&quot;http://some.url.3/?v=&quot;</span> + resp )
    );
} )

.then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP3</span>(<span class="hljs-params">r1,r2</span>)</span>{ <span class="hljs-keyword">return</span> r1 + r2; } );
</code></pre>
<p>&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x4E24;&#x4E2A;&#x5730;&#x65B9;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>steps.then(..)</code>&#x6761;&#x4EF6;&#x6027;&#x5730;&#x6269;&#x5C55;&#x4E86;<code>step</code>&#x3002;&#x4E3A;&#x4E86;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;<code>steps</code>&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x4F7F;&#x7528;<code>ASQ#runner(..)</code>&#x5C06;&#x5B83;&#x4E0E;&#x4E00;&#x4E2A; <em>asynquence</em> &#x5E8F;&#x5217;&#xFF08;&#x8FD9;&#x91CC;&#x79F0;&#x4E3A;<code>main</code>&#xFF09;&#x94FE;&#x63A5;&#x8FDB;&#x6211;&#x4EEC;&#x7684;&#x4E3B;&#x7A0B;&#x5E8F;&#x6D41;&#x7A0B;&#x4E2D;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> main = ASQ( {
    url: <span class="hljs-string">&quot;http://some.url.1&quot;</span>,
    format: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP4</span>(<span class="hljs-params">text</span>)</span>{
        <span class="hljs-keyword">return</span> text.toUpperCase();
    }
} )
.runner( steps )
.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>)</span>{
    <span class="hljs-built_in">console</span>.log( msg );
} );
</code></pre>
<p><code>steps</code>&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A; generator &#x6765;&#x8868;&#x8FBE;&#x5417;&#xFF1F;&#x67D0;&#x79CD;&#x610F;&#x4E49;&#x4E0A;&#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x4E0D;&#x5F97;&#x4E0D;&#x4EE5;&#x4E00;&#x79CD;&#x6709;&#x4E9B;&#x5C34;&#x5C2C;&#x7684;&#x65B9;&#x5F0F;&#x91CD;&#x65B0;&#x5B89;&#x6392;&#x903B;&#x8F91;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> *<span class="hljs-title">steps</span>(<span class="hljs-params">token</span>) </span>{
    <span class="hljs-comment">// **&#x6B65;&#x9AA4; 1**</span>
    <span class="hljs-keyword">var</span> resp = <span class="hljs-keyword">yield</span> request( token.messages[<span class="hljs-number">0</span>].url );

    <span class="hljs-comment">// **&#x6B65;&#x9AA4; 2**</span>
    <span class="hljs-keyword">var</span> rvals = <span class="hljs-keyword">yield</span> ASQ().gate(
        request( <span class="hljs-string">&quot;http://some.url.2/?v=&quot;</span> + resp ),
        request( <span class="hljs-string">&quot;http://some.url.3/?v=&quot;</span> + resp )
    );

    <span class="hljs-comment">// **&#x6B65;&#x9AA4; 3**</span>
    <span class="hljs-keyword">var</span> text = rvals[<span class="hljs-number">0</span>] + rvals[<span class="hljs-number">1</span>];

    <span class="hljs-comment">// **&#x6B65;&#x9AA4; 4**</span>
    <span class="hljs-comment">// &#x6709;&#x989D;&#x5916;&#x7684;&#x683C;&#x5F0F;&#x5316;&#x6B65;&#x9AA4;&#x88AB;&#x63D0;&#x4F9B;&#x5417;&#xFF1F;</span>
    <span class="hljs-keyword">if</span> (token.messages[<span class="hljs-number">0</span>].format) {
        text = <span class="hljs-keyword">yield</span> token.messages[<span class="hljs-number">0</span>].format( text );
    }

    <span class="hljs-comment">// **&#x6B65;&#x9AA4; 5**</span>
    <span class="hljs-comment">// &#x8981;&#x4E3A;&#x5E8F;&#x5217;&#x589E;&#x52A0;&#x53E6;&#x4E00;&#x4E2A;Ajax&#x8BF7;&#x6C42;&#x5417;&#xFF1F;</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/foobar/</span>.test( resp )) {
        text = <span class="hljs-keyword">yield</span> request(
            <span class="hljs-string">&quot;http://some.url.4/?v=&quot;</span> + text
        );
    }

    <span class="hljs-keyword">return</span> text;
}

<span class="hljs-comment">// &#x6CE8;&#x610F;&#xFF1A;`*steps()`&#x53EF;&#x4EE5;&#x5411;&#x5148;&#x524D;&#x7684;`step`&#x4E00;&#x6837;&#x88AB;&#x76F8;&#x540C;&#x7684;`ASQ`&#x5E8F;&#x5217;&#x8FD0;&#x884C;</span>
</code></pre>
<p>&#x5148;&#x628A;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x7684;&#x5E8F;&#x5217;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x4EE5;&#x53CA;&#x770B;&#x8D77;&#x6765;&#x540C;&#x6B65;&#x7684; generator &#x8BED;&#x6CD5;&#xFF08;&#x89C1;&#x7B2C;&#x56DB;&#x7AE0;&#xFF09;&#x653E;&#x5728;&#x4E00;&#x8FB9;&#xFF0C;<code>steps</code>&#x903B;&#x8F91;&#x4E0D;&#x5F97;&#x4E0D;&#x5728;<code>*steps()</code> generator &#x5F62;&#x5F0F;&#x4E2D;&#x91CD;&#x6392;&#xFF0C;&#x6765;&#x5047;&#x5192;&#x53EF;&#x6269;&#x5C55;&#x7684;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;<code>steps</code>&#x7684;&#x52A8;&#x6001;&#x673A;&#x5236;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#xFF0C;&#x4F7F;&#x7528; Promise &#x6216;&#x8005;&#x5E8F;&#x5217;&#x5982;&#x4F55;&#x8868;&#x8FBE;&#x8FD9;&#x79CD;&#x529F;&#x80FD;&#x5462;&#xFF1F;&#x4F60; <em>&#x53EF;&#x4EE5;</em> &#x8FD9;&#x4E48;&#x505A;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> steps = something( .. )
.then( .. )
.then( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">..</span>)</span>{
    <span class="hljs-comment">// ..</span>

    <span class="hljs-comment">// &#x6269;&#x5C55;&#x8FD9;&#x4E2A;&#x94FE;&#x6761;&#xFF0C;&#x5BF9;&#x5427;&#xFF1F;</span>
    steps = steps.then( .. );

    <span class="hljs-comment">// ..</span>
})
.then( .. );
</code></pre>
<p>&#x8FD9;&#x91CC;&#x8981;&#x6293;&#x4F4F;&#x7684;&#x95EE;&#x9898;&#x5F88;&#x5FAE;&#x5999;&#x4F46;&#x5F88;&#x91CD;&#x8981;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x8003;&#x8651;&#x8BD5;&#x7740;&#x5C06;&#x6211;&#x4EEC;&#x7684;<code>stpes</code> Promise &#x94FE;&#x8FDE;&#x63A5;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x4E3B;&#x7A0B;&#x5E8F;&#x6D41;&#x7A0B;&#x4E2D; &#x2014;&#x2014; &#x8FD9;&#x6B21;&#x4F7F;&#x7528; Promise &#x4EE3;&#x66FF; <em>asynquence</em> &#x6765;&#x8868;&#x8FBE;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> main = <span class="hljs-built_in">Promise</span>.resolve( {
    url: <span class="hljs-string">&quot;http://some.url.1&quot;</span>,
    format: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">STEP4</span>(<span class="hljs-params">text</span>)</span>{
        <span class="hljs-keyword">return</span> text.toUpperCase();
    }
} )
.then( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">..</span>)</span>{
    <span class="hljs-keyword">return</span> steps;            <span class="hljs-comment">// &#x63D0;&#x793A;&#xFF01;</span>
} )
.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>)</span>{
    <span class="hljs-built_in">console</span>.log( msg );
} );
</code></pre>
<p>&#x73B0;&#x5728;&#x4F60;&#x80FD;&#x53D1;&#x73B0;&#x95EE;&#x9898;&#x5417;&#xFF1F;&#x4ED4;&#x7EC6;&#x89C2;&#x5BDF;&#xFF01;</p>
<p>&#x5BF9;&#x4E8E;&#x5E8F;&#x5217;&#x6B65;&#x9AA4;&#x7684;&#x987A;&#x5E8F;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x7ADE;&#x5408;&#x72B6;&#x6001;&#x3002;&#x5F53;&#x4F60;<code>return steps</code>&#x65F6;&#xFF0C;<code>steps</code>&#x5728;&#x90A3;&#x4E2A;&#x65F6;&#x523B; <em>&#x53EF;&#x80FD;</em> &#x662F;&#x539F;&#x672C;&#x5B9A;&#x4E49;&#x597D;&#x7684; promise &#x94FE;&#x4E86;&#xFF0C;&#x6216;&#x8005;&#x5B83;&#x73B0;&#x5728;&#x53EF;&#x80FD;&#x901A;&#x8FC7;<code>steps = steps.then(..)</code>&#x8C03;&#x7528;&#x6B63;&#x6307;&#x5411;&#x6269;&#x5F20;&#x7684; promise &#x94FE;&#xFF0C;&#x8FD9;&#x8981;&#x770B;&#x4E8B;&#x60C5;&#x4EE5;&#x4EC0;&#x4E48;&#x987A;&#x5E8F;&#x53D1;&#x751F;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x79CD;&#x53EF;&#x80FD;&#x7684;&#x7ED3;&#x679C;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x679C;<code>steps</code>&#x4ECD;&#x7136;&#x662F;&#x539F;&#x6765;&#x7684; Promise &#x94FE;&#xFF0C;&#x4E00;&#x65E6;&#x5B83;&#x7A0D;&#x540E;&#x901A;&#x8FC7;<code>steps = steps.then(..)</code>&#x201C;&#x6269;&#x5C55;&#x201D;&#xFF0C;&#x8FD9;&#x4E2A;&#x4F4D;&#x4E8E;&#x94FE;&#x6761;&#x672B;&#x5C3E;&#x7684;&#x6269;&#x5C55;&#x8FC7;&#x7684; promise &#x662F; <strong>&#x4E0D;&#x4F1A;</strong> &#x88AB;<code>main</code>&#x6D41;&#x7A0B;&#x8003;&#x8651;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;<code>steps</code>&#x94FE;&#x4E86;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x4E0D;&#x5E78;&#x7684; <strong>&#x6025;&#x5207;&#x6C42;&#x503C;</strong> &#x9650;&#x5236;&#x3002;</li>
<li>&#x5982;&#x679C;<code>steps</code>&#x5DF2;&#x7ECF;&#x662F;&#x6269;&#x5C55;&#x8FC7;&#x7684; promise &#x94FE;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x6269;&#x5C55;&#x8FC7;&#x7684; promise &#x6B63;&#x662F;<code>main</code>&#x8981;&#x901A;&#x8FC7;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4F1A;&#x5982;&#x6211;&#x4EEC;&#x671F;&#x671B;&#x7684;&#x90A3;&#x6837;&#x5DE5;&#x4F5C;&#x3002;</li>
</ul>
<p>&#x7B2C;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x9664;&#x4E86;&#x5C55;&#x793A;&#x7ADE;&#x5408;&#x72B6;&#x6001;&#x4E0D;&#x53EF;&#x5BB9;&#x5FCD;&#x7684;&#x660E;&#x663E;&#x4E8B;&#x5B9E;&#xFF0C;&#x5B83;&#x8FD8;&#x5C55;&#x793A;&#x4E86; promise &#x94FE;&#x7684; <strong>&#x6025;&#x5207;&#x6C42;&#x503C;</strong>&#x3002;&#x76F8;&#x6BD4;&#x4E4B;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x6269;&#x5C55;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x800C;&#x6CA1;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x662F; <strong>&#x61D2;&#x60F0;&#x6C42;&#x503C;</strong> &#x7684;&#x3002;</p>
<p>&#x4F60;&#x8D8A;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x7684;&#x6D41;&#x7A0B;&#x63A7;&#x5236;&#x52A8;&#x6001;&#xFF0C;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x5C31;&#x8D8A;&#x663E;&#x5F97;&#x5F3A;&#x5927;&#x3002;</p>
<p><strong>&#x63D0;&#x793A;&#xFF1A;</strong> &#x5728; <em>asynquence</em> &#x7684;&#x7F51;&#x7AD9;(<a href="https://github.com/getify/asynquence/blob/master/README.md#iterable-sequences)&#x4E0A;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x66F4;&#x591A;&#x5173;&#x4E8E;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x7684;&#x4FE1;&#x606F;&#x4E0E;&#x793A;&#x4F8B;&#x3002;" target="_blank">https://github.com/getify/asynquence/blob/master/README.md#iterable-sequences)&#x4E0A;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x66F4;&#x591A;&#x5173;&#x4E8E;&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x7684;&#x4FE1;&#x606F;&#x4E0E;&#x793A;&#x4F8B;&#x3002;</a></p>
<h2 id="&#x4E8B;&#x4EF6;&#x54CD;&#x5E94;&#x5F0F;">&#x4E8B;&#x4EF6;&#x54CD;&#x5E94;&#x5F0F;</h2>
<p>&#xFF08;&#x81F3;&#x5C11;&#xFF01;&#xFF09;&#x4ECE;&#x7B2C;&#x4E09;&#x7AE0;&#x770B;&#x6765;&#x8FD9;&#x5E94;&#x5F53;&#x5F88;&#x660E;&#x663E;&#xFF1A;Promise &#x662F;&#x4F60;&#x5F02;&#x6B65;&#x5DE5;&#x5177;&#x7BB1;&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#x975E;&#x5E38;&#x5F3A;&#x5927;&#x7684;&#x5DE5;&#x5177;&#x3002;&#x4F46;&#x5B83;&#x4EEC;&#x660E;&#x663E;&#x7F3A;&#x4E4F;&#x5904;&#x7406;&#x4E8B;&#x4EF6;&#x6D41;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x4E2A; Promise &#x53EA;&#x80FD;&#x88AB;&#x89E3;&#x6790;&#x4E00;&#x6B21;&#x3002;&#x800C;&#x4E14;&#x5766;&#x767D;&#x5730;&#x8BB2;&#xFF0C;&#x5BF9;&#x4E8E; <em>asynquence</em> &#x5E8F;&#x5217;&#x6765;&#x8BF4;&#x8FD9;&#x4E5F;&#x6B63;&#x662F;&#x5B83;&#x7684;&#x4E00;&#x4E2A;&#x5F31;&#x70B9;&#x3002;</p>
<p>&#x8003;&#x8651;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#xFF1A;&#x4F60;&#x60F3;&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x4E8B;&#x4EF6;&#x6BCF;&#x6B21;&#x88AB;&#x89E6;&#x53D1;&#x65F6;&#x89E6;&#x53D1;&#x4E00;&#x7CFB;&#x5217;&#x6B65;&#x9AA4;&#x3002;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684; Promise &#x6216;&#x5E8F;&#x5217;&#x4E0D;&#x80FD;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x5168;&#x90E8;&#x7684;&#x53D1;&#x751F;&#x72B6;&#x51B5;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x4F60;&#x4E0D;&#x5F97;&#x4E0D;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x7684;&#x53D1;&#x751F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5168;&#x65B0;&#x7684; Promise &#x94FE;&#xFF08;&#x6216;&#x5E8F;&#x5217;&#xFF09;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p>
<pre><code class="lang-js">listener.on( <span class="hljs-string">&quot;foobar&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>{

    <span class="hljs-comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4E8B;&#x4EF6;&#x5904;&#x7406; Promise &#x94FE;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>)</span>{
        <span class="hljs-comment">// ..</span>
    } )
    .then( .. )
    .then( .. );

} );
</code></pre>
<p>&#x5728;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x62E5;&#x6709;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x57FA;&#x672C;&#x529F;&#x80FD;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x8868;&#x8FBE;&#x6211;&#x4EEC;&#x610F;&#x56FE;&#x4E2D;&#x7684;&#x903B;&#x8F91;&#x6765;&#x8BF4;&#x8FDC;&#x4E0D;&#x80FD;&#x4F7F;&#x4EBA;&#x6EE1;&#x610F;&#x3002;&#x4E24;&#x79CD;&#x5206;&#x79BB;&#x7684;&#x80FD;&#x529B;&#x6DF7;&#x6742;&#x5728;&#x8FD9;&#x4E2A;&#x8303;&#x4F8B;&#x4E2D;&#xFF1A;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#xFF0C;&#x4E0E;&#x4E8B;&#x4EF6;&#x5E94;&#x7B54;&#xFF1B;&#x800C;&#x5173;&#x6CE8;&#x70B9;&#x5206;&#x79BB;&#x539F;&#x5219;&#x6073;&#x6C42;&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x4E9B;&#x80FD;&#x529B;&#x5206;&#x5F00;&#x3002;</p>
<p>&#x7EC6;&#x5FC3;&#x7684;&#x8BFB;&#x8005;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E0E;&#x6211;&#x4EEC;&#x5728;&#x7B2C;&#x4E8C;&#x7AE0;&#x4E2D;&#x8BE6;&#x7EC6;&#x8BB2;&#x89E3;&#x8FC7;&#x7684;&#x95EE;&#x9898;&#x662F;&#x6709;&#x4E9B;&#x5BF9;&#x79F0;&#x7684;&#xFF1B;&#x5B83;&#x662F;&#x4E00;&#x79CD;&#x63A7;&#x5236;&#x53CD;&#x8F6C;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#x975E;&#x53CD;&#x8F6C;&#x8FD9;&#x4E2A;&#x8303;&#x4F8B;&#xFF0C;&#x5C31;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> observable = listener.on( <span class="hljs-string">&quot;foobar&quot;</span> );

<span class="hljs-comment">// &#x7A0D;&#x540E;</span>
observable
.then( .. )
.then( .. );

<span class="hljs-comment">// &#x5728;&#x5176;&#x4ED6;&#x7684;&#x5730;&#x65B9;</span>
observable
.then( .. )
.then( .. );
</code></pre>
<p>&#x503C;<code>observable</code>&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684; Promise&#xFF0C;&#x4F46;&#x4F60;&#x53EF;&#x4EE5;&#x50CF;&#x76D1;&#x542C;&#x4E00;&#x4E2A; Promise &#x90A3;&#x6837; <em>&#x76D1;&#x542C;</em> &#x5B83;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x662F;&#x6709;&#x5BC6;&#x5207;&#x5173;&#x8054;&#x7684;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x88AB;&#x76D1;&#x542C;&#x5F88;&#x591A;&#x6B21;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x4F1A;&#x5728;&#x6BCF;&#x6B21;&#x4E8B;&#x4EF6;&#xFF08;<code>&quot;foobar&quot;</code>&#xFF09;&#x53D1;&#x751F;&#x65F6;&#x90FD;&#x53D1;&#x9001;&#x901A;&#x77E5;&#x3002;</p>
<p><strong>&#x63D0;&#x793A;&#xFF1A;</strong> &#x6211;&#x521A;&#x521A;&#x5C55;&#x793A;&#x8FC7;&#x7684;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#xFF0C;&#x662F;&#x54CD;&#x5E94;&#x5F0F;&#x7F16;&#x7A0B;&#xFF08;reactive programming&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A; RP&#xFF09;&#x80CC;&#x540E;&#x7684;&#x6982;&#x5FF5;&#x548C;&#x52A8;&#x673A;&#x7684; <strong>&#x5927;&#x5E45;&#x5EA6;&#x7B80;&#x5316;</strong>&#xFF0C;&#x54CD;&#x5E94;&#x5F0F;&#x7F16;&#x7A0B;&#x5DF2;&#x7ECF;&#x7531;&#x597D;&#x51E0;&#x79CD;&#x4E86;&#x4E0D;&#x8D77;&#x7684;&#x9879;&#x76EE;&#x548C;&#x8BED;&#x8A00;&#x5B9E;&#x73B0;/&#x8BE6;&#x7EC6;&#x8BBA;&#x8FF0;&#x8FC7;&#x4E86;&#x3002;RP &#x7684;&#x4E00;&#x4E2A;&#x53D8;&#x79CD;&#x662F;&#x51FD;&#x6570;&#x54CD;&#x5E94;&#x5F0F;&#x7F16;&#x7A0B;&#xFF08;functional reactive programming&#xFF0C;FRP&#xFF09;&#xFF0C;&#x5B83;&#x6307;&#x7684;&#x662F;&#x5728;&#x6570;&#x636E;&#x6D41;&#x4E4B;&#x4E0A;&#x5B9E;&#x65BD;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x6280;&#x672F;&#xFF08;&#x4E0D;&#x53EF;&#x53D8;&#x6027;&#xFF0C;&#x53C2;&#x7167;&#x5B8C;&#x6574;&#x6027;&#xFF0C;&#x7B49;&#x7B49;&#xFF09;&#x3002;&#x201C;&#x54CD;&#x5E94;&#x5F0F;&#x201D;&#x6307;&#x7684;&#x662F;&#x968F;&#x7740;&#x4E8B;&#x4EF6;&#x7684;&#x63A8;&#x79FB;&#x6563;&#x5E03;&#x8FD9;&#x79CD;&#x529F;&#x80FD;&#xFF0C;&#x4EE5;&#x5BF9;&#x4E8B;&#x4EF6;&#x8FDB;&#x884C;&#x5E94;&#x7B54;&#x3002;&#x5BF9;&#x6B64;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#x5E94;&#x5F53;&#x8003;&#x8651;&#x5B66;&#x4E60;&#x201C;&#x54CD;&#x5E94;&#x5F0F;&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;&#x201D;&#xFF0C;&#x5B83;&#x6E90;&#x4E8E;&#x7531;&#x5FAE;&#x8F6F;&#x5F00;&#x53D1;&#x7684;&#x795E;&#x5947;&#x7684;&#x201C;&#x54CD;&#x5E94;&#x5F0F;&#x6269;&#x5C55;&#x201D;&#x5E93;(&#x5BF9;&#x4E8E; JavaScript &#x6765;&#x8BF4;&#x662F; &#x201C;RxJS&#x201D;&#xFF0C;<a href="http://rxjs.codeplex.com/)&#xFF1B;&#x5B83;&#x53EF;&#x8981;&#x6BD4;&#x6211;&#x521A;&#x521A;&#x5C55;&#x793A;&#x8FC7;&#x7684;&#x4E1C;&#x897F;&#x7CBE;&#x5DE7;&#x548C;&#x5F3A;&#x5927;&#x592A;&#x591A;&#x4E86;&#x3002;&#x53E6;&#x5916;&#xFF0C;Andre" target="_blank">http://rxjs.codeplex.com/)&#xFF1B;&#x5B83;&#x53EF;&#x8981;&#x6BD4;&#x6211;&#x521A;&#x521A;&#x5C55;&#x793A;&#x8FC7;&#x7684;&#x4E1C;&#x897F;&#x7CBE;&#x5DE7;&#x548C;&#x5F3A;&#x5927;&#x592A;&#x591A;&#x4E86;&#x3002;&#x53E6;&#x5916;&#xFF0C;Andre</a> Staltz &#x5199;&#x8FC7;&#x4E00;&#x7BC7;&#x51FA;&#x8272;&#x7684;&#x6587;&#x7AE0;(<a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754)&#xFF0C;&#x7528;&#x5177;&#x4F53;&#x7684;&#x4F8B;&#x5B50;&#x9AD8;&#x6548;&#x5730;&#x8BB2;&#x89E3;&#x4E86;" target="_blank">https://gist.github.com/staltz/868e7e9bc2a7b8c1f754)&#xFF0C;&#x7528;&#x5177;&#x4F53;&#x7684;&#x4F8B;&#x5B50;&#x9AD8;&#x6548;&#x5730;&#x8BB2;&#x89E3;&#x4E86;</a> RP&#x3002;</p>
<h3 id="es7-&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;">ES7 &#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;</h3>
<p>&#x5728;&#x672C;&#x4E66;&#x5199;&#x4F5C;&#x65F6;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x65E9;&#x671F;ES7&#x63D0;&#x6848;&#xFF0C;&#x4E00;&#x79CD;&#x79F0;&#x4E3A;&#x201C;Observable&#xFF08;&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;&#xFF09;&#x201D;&#x7684;&#x65B0;&#x6570;&#x636E;&#x7C7B;&#x578B;(<a href="https://github.com/jhusain/asyncgenerator#introducing-observable)&#xFF0C;&#x5B83;&#x5728;&#x7CBE;&#x795E;&#x4E0A;&#x4E0E;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x91CC;&#x8BB2;&#x89E3;&#x8FC7;&#x7684;&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;&#x7EDD;&#x5BF9;&#x66F4;&#x7CBE;&#x5DE7;&#x3002;" target="_blank">https://github.com/jhusain/asyncgenerator#introducing-observable)&#xFF0C;&#x5B83;&#x5728;&#x7CBE;&#x795E;&#x4E0A;&#x4E0E;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x91CC;&#x8BB2;&#x89E3;&#x8FC7;&#x7684;&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;&#x7EDD;&#x5BF9;&#x66F4;&#x7CBE;&#x5DE7;&#x3002;</a></p>
<p>&#x8FD9;&#x79CD;&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;&#x7684;&#x6982;&#x5FF5;&#x662F;&#xFF0C;&#x4F60;&#x5728;&#x4E00;&#x4E2A;&#x6D41;&#x4E0A;&#x201C;&#x76D1;&#x542C;&#x201D;&#x4E8B;&#x4EF6;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x4F20;&#x5165;&#x4E00;&#x4E2A; generator &#x2014;&#x2014; &#x5176;&#x5B9E; <em>&#x8FED;&#x4EE3;&#x5668;</em> &#x624D;&#x662F;&#x6709;&#x8DA3;&#x7684;&#x90E8;&#x5206; &#x2014;&#x2014; &#x5B83;&#x7684;<code>next(..)</code>&#x65B9;&#x6CD5;&#x4F1A;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x800C;&#x8C03;&#x7528;&#x3002;</p>
<p>&#x4F60;&#x53EF;&#x4EE5;&#x60F3;&#x8C61;&#x5B83;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x79CD;&#x4E1C;&#x897F;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-comment">// `someEventStream` &#x662F;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x6D41;&#xFF0C;&#x6765;&#x81EA;&#x4E8E;&#x9F20;&#x6807;&#x70B9;&#x51FB;&#x4E4B;&#x7C7B;</span>

<span class="hljs-keyword">var</span> observer = <span class="hljs-keyword">new</span> Observer( someEventStream, <span class="hljs-function"><span class="hljs-keyword">function</span>*(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">var</span> evt = <span class="hljs-keyword">yield</span>) {
        <span class="hljs-built_in">console</span>.log( evt );
    }
} );
</code></pre>
<p>&#x4F60;&#x4F20;&#x5165;&#x7684; generator &#x5C06;&#x4F1A;<code>yield</code>&#x800C;&#x6682;&#x505C;<code>while</code>&#x5FAA;&#x73AF;&#xFF0C;&#x6765;&#x7B49;&#x5F85;&#x4E0B;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x3002;&#x6DFB;&#x9644;&#x5728; generator &#x5B9E;&#x4F8B;&#x4E0A;&#x7684; <em>&#x8FED;&#x4EE3;&#x5668;</em> &#x7684;<code>next(..)</code>&#x5C06;&#x4F1A;&#x5728;&#x6BCF;&#x6B21;<code>someEventStream</code>&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x65B0;&#x4E8B;&#x4EF6;&#x65F6;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x5C06;&#x4F1A;&#x4F7F;&#x7528;<code>evt</code>&#x6570;&#x636E;&#x63A8;&#x8FDB;&#x4F60;&#x7684; generator/<em>&#x8FED;&#x4EE3;&#x5668;</em>&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x91CC;&#x7684;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;&#x529F;&#x80FD;&#x4E2D;&#xFF0C;&#x91CD;&#x8981;&#x7684;&#x662F; <em>&#x8FED;&#x4EE3;&#x5668;</em> &#x7684;&#x90E8;&#x5206;&#xFF0C;&#x800C;&#x4E0D;&#x662F; generator&#x3002;&#x6240;&#x4EE5;&#x4ECE;&#x6982;&#x5FF5;&#x4E0A;&#x8BB2;&#xFF0C;&#x4F60;&#x5B9E;&#x8D28;&#x4E0A;&#x53EF;&#x4EE5;&#x4F20;&#x5165;&#x4EFB;&#x4F55;&#x53EF;&#x8FED;&#x4EE3;&#x5BF9;&#x8C61;&#xFF0C;&#x5305;&#x62EC;<code>ASQ.iterable()</code>&#x53EF;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;&#x3002;</p>
<p>&#x6709;&#x8DA3;&#x7684;&#x662F;&#xFF0C;&#x8FD8;&#x5B58;&#x5728;&#x4E00;&#x4E9B;&#x88AB;&#x63D0;&#x6848;&#x7684;&#x9002;&#x914D;&#x65B9;&#x6848;&#xFF0C;&#x4F7F;&#x5F97;&#x4ECE;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x6D41;&#x4E2D;&#x6784;&#x5EFA;&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;&#x53D8;&#x5F97;&#x5BB9;&#x6613;&#xFF0C;&#x4F8B;&#x5982;&#x4E3A;DOM&#x4E8B;&#x4EF6;&#x63D0;&#x6848;&#x7684;<code>fromEvent(..)</code>&#x3002;&#x5982;&#x679C;&#x4F60;&#x53BB;&#x770B;&#x770B;<code>fromEvent(..)</code>&#x5728;&#x65E9;&#x671F;ES7&#x63D0;&#x6848;&#x4E2D;&#x63A8;&#x8350;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x4E0E;&#x6211;&#x4EEC;&#x5C06;&#x8981;&#x5728;&#x4E0B;&#x4E00;&#x8282;&#x4E2D;&#x770B;&#x5230;&#x7684;<code>ASQ.react(..)</code>&#x6781;&#x5176;&#x76F8;&#x4F3C;&#x3002;</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x65E9;&#x671F;&#x63D0;&#x6848;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x7EC8;&#x8131;&#x9896;&#x800C;&#x51FA;&#x7684;&#x4E1C;&#x897F;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x5916;&#x89C2;/&#x884C;&#x4E3A;&#x4E0A;&#x4E0E;&#x8FD9;&#x91CC;&#x5C55;&#x793A;&#x7684;&#x6709;&#x5F88;&#x5927;&#x7684;&#x4E0D;&#x540C;&#x3002;&#x4F46;&#x662F;&#x770B;&#x5230;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5E93;&#x4E0E;&#x8BED;&#x8A00;&#x63D0;&#x6848;&#x5728;&#x6982;&#x5FF5;&#x4E0A;&#x7684;&#x65E9;&#x671F;&#x7EDF;&#x4E00;&#x8FD8;&#x662F;&#x5F88;&#x6FC0;&#x52A8;&#x4EBA;&#x5FC3;&#x7684;&#xFF01;</p>
<h3 id="&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;">&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;</h3>
<p>&#x5C06;&#x8FD9;&#x79CD;&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;&#xFF08;&#x548C;F/RP&#xFF09;&#x7684;&#x8D85;&#x7EA7;&#x7B80;&#x8981;&#x7684;&#x6982;&#x89C8;&#x4F5C;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x542F;&#x53D1;&#x4E0E;&#x52A8;&#x673A;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x5C06;&#x5C55;&#x793A;&#x4E00;&#x79CD;&#x201C;&#x54CD;&#x5E94;&#x5F0F;&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;&#x201D;&#x7684;&#x5F88;&#x5C0F;&#x7684;&#x5B50;&#x96C6;&#x7684;&#x9002;&#x914D;&#x65B9;&#x6848;&#xFF0C;&#x6211;&#x79F0;&#x4E4B;&#x4E3A;&#x201C;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#x201D;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x4ECE;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;&#x5F00;&#x59CB;&#xFF0C;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x79F0;&#x4E3A;<code>react(..)</code>&#x7684; <em>asynquence</em> &#x63D2;&#x4EF6;&#x5DE5;&#x5177;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> observable = ASQ.react( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span>(<span class="hljs-params">next</span>)</span>{
    listener.on( <span class="hljs-string">&quot;foobar&quot;</span>, next );
} );
</code></pre>
<p>&#x73B0;&#x5728;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x5982;&#x4F55;&#x4E3A;&#x8FD9;&#x4E2A;<code>observable</code>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x201C;&#x54CD;&#x5E94;&#x7684;&#x201D;&#x5E8F;&#x5217; &#x2014;&#x2014; &#x5728;F/RP&#x4E2D;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x79F0;&#x4E3A;&#x201C;&#x76D1;&#x542C;&#x201D;&#xFF1A;</p>
<pre><code class="lang-js">observable
.seq( .. )
.then( .. )
.val( .. );
</code></pre>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x4F60;&#x53EA;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x5728;&#x8FD9;&#x4E2A;&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;&#x540E;&#x9762;&#x8FDB;&#x884C;&#x94FE;&#x63A5;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x5F88;&#x5BB9;&#x6613;&#xFF0C;&#x662F;&#x5427;&#xFF1F;</p>
<p>&#x5728;F/RP&#x4E2D;&#xFF0C;&#x4E8B;&#x4EF6;&#x6D41;&#x7ECF;&#x5E38;&#x4F1A;&#x901A;&#x8FC7;&#x4E00;&#x7EC4;&#x51FD;&#x6570;&#x5F0F;&#x7684;&#x53D8;&#x5F62;&#xFF0C;&#x6BD4;&#x5982;<code>scan(..)</code>&#xFF0C;<code>map(..)</code>&#xFF0C;<code>reduce(..)</code>&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x4F7F;&#x7528;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#xFF0C;&#x6BCF;&#x4E2A;&#x4E8B;&#x4EF6;&#x4F1A;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x7684;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E2A;&#x66F4;&#x5177;&#x4F53;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-js">ASQ.react( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span>(<span class="hljs-params">next</span>)</span>{
    <span class="hljs-built_in">document</span>.getElementById( <span class="hljs-string">&quot;mybtn&quot;</span> )
    .addEventListener( <span class="hljs-string">&quot;click&quot;</span>, next, <span class="hljs-literal">false</span> );
} )
.seq( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>{
    <span class="hljs-keyword">var</span> btnID = evt.target.id;
    <span class="hljs-keyword">return</span> request(
        <span class="hljs-string">&quot;http://some.url.1/?id=&quot;</span> + btnID
    );
} )
.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">text</span>)</span>{
    <span class="hljs-built_in">console</span>.log( text );
} );
</code></pre>
<p>&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#x7684;&#x201C;&#x54CD;&#x5E94;&#x5F0F;&#x201D;&#x90E8;&#x5206;&#x6765;&#x6E90;&#x4E8E;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x5668;&#x6765;&#x8C03;&#x7528;&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x5668;&#xFF08;&#x8C03;&#x7528;<code>next(..)</code>&#xFF09;&#x3002;</p>
<p>&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#x7684;&#x201C;&#x5E8F;&#x5217;&#x201D;&#x90E8;&#x5206;&#x6B63;&#x662F;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x63A2;&#x7D22;&#x8FC7;&#x7684;&#xFF1A;&#x6BCF;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#x90FD;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x4F55;&#x5408;&#x7406;&#x7684;&#x5F02;&#x6B65;&#x6280;&#x672F; &#x2014;&#x2014; &#x5EF6;&#x7EED;&#x56DE;&#x8C03;&#xFF0C;Promise &#x6216;&#x8005; generator&#x3002;</p>
<p>&#x4E00;&#x65E6;&#x62DF;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#xFF0C;&#x53EA;&#x8981;&#x4E8B;&#x4EF6;&#x88AB;&#x6301;&#x7EED;&#x5730;&#x89E6;&#x53D1;&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x4E00;&#x76F4;&#x521D;&#x59CB;&#x5316;&#x5E8F;&#x5217;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x505C;&#x6B62;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x8C03;&#x7528;<code>stop()</code>&#x3002;</p>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#x88AB;<code>stop()</code>&#x4E86;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x8FD8;&#x60F3;&#x6CE8;&#x9500;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x5668;&#xFF1B;&#x4E3A;&#x6B64;&#x4F60;&#x53EF;&#x4EE5;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x62C6;&#x5378;&#x5904;&#x7406;&#x5668;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> sq = ASQ.react( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span>(<span class="hljs-params">next,registerTeardown</span>)</span>{
    <span class="hljs-keyword">var</span> btn = <span class="hljs-built_in">document</span>.getElementById( <span class="hljs-string">&quot;mybtn&quot;</span> );

    btn.addEventListener( <span class="hljs-string">&quot;click&quot;</span>, next, <span class="hljs-literal">false</span> );

    <span class="hljs-comment">// &#x53EA;&#x8981;`sq.stop()`&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x5B83;&#x5C31;&#x4F1A;&#x88AB;&#x8C03;&#x7528;</span>
    registerTeardown( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        btn.removeEventListener( <span class="hljs-string">&quot;click&quot;</span>, next, <span class="hljs-literal">false</span> );
    } );
} )
.seq( .. )
.then( .. )
.val( .. );

<span class="hljs-comment">// &#x7A0D;&#x540E;</span>
sq.stop();
</code></pre>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong> &#x5728;<code>setup(..)</code>&#x5904;&#x7406;&#x5668;&#x5185;&#x90E8;&#x7684;<code>this</code>&#x7ED1;&#x5B9A;&#x5F15;&#x7528;&#x662F;<code>sq</code>&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#x7684;&#x5B9A;&#x4E49;&#x4E2D;&#x4F7F;&#x7528;<code>this</code>&#x5F15;&#x7528;&#xFF0C;&#x6BD4;&#x5982;&#x8C03;&#x7528;<code>stop()</code>&#x4E4B;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6765;&#x81EA; Node.js &#x4E16;&#x754C;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x4F7F;&#x7528;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#x5904;&#x7406;&#x5230;&#x6765;&#x7684;HTTP&#x8BF7;&#x6C42;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> server = http.createServer();
server.listen(<span class="hljs-number">8000</span>);

<span class="hljs-comment">// &#x54CD;&#x5E94;&#x5F0F;&#x76D1;&#x542C;</span>
<span class="hljs-keyword">var</span> request = ASQ.react( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span>(<span class="hljs-params">next,registerTeardown</span>)</span>{
    server.addListener( <span class="hljs-string">&quot;request&quot;</span>, next );
    server.addListener( <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-keyword">this</span>.stop );

    registerTeardown( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        server.removeListener( <span class="hljs-string">&quot;request&quot;</span>, next );
        server.removeListener( <span class="hljs-string">&quot;close&quot;</span>, request.stop );
    } );
});

<span class="hljs-comment">// &#x5E94;&#x7B54;&#x8BF7;&#x6C42;</span>
request
.seq( pullFromDatabase )
.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data,res</span>)</span>{
    res.end( data );
} );

<span class="hljs-comment">// &#x5173;&#x95ED; node</span>
process.on( <span class="hljs-string">&quot;SIGINT&quot;</span>, request.stop );
</code></pre>
<p><code>next(..)</code>&#x89E6;&#x53D1;&#x5668;&#x8FD8;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x9002;&#x914D; node &#x6D41;&#xFF0C;&#x4F7F;&#x7528;<code>onStream(..)</code>&#x548C;<code>unStream(..)</code>&#xFF1A;</p>
<pre><code class="lang-js">ASQ.react( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span>(<span class="hljs-params">next</span>)</span>{
    <span class="hljs-keyword">var</span> fstream = fs.createReadStream( <span class="hljs-string">&quot;/some/file&quot;</span> );

    <span class="hljs-comment">// &#x5C06;&#x6D41;&#x7684; &quot;data&quot; &#x4E8B;&#x4EF6;&#x5BFC;&#x5411; `next(..)`</span>
    next.onStream( fstream );

    <span class="hljs-comment">// &#x76D1;&#x542C;&#x6D41;&#x7684;&#x7ED3;&#x675F;</span>
    fstream.on( <span class="hljs-string">&quot;end&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        next.unStream( fstream );
    } );
} )
.seq( .. )
.then( .. )
.val( .. );
</code></pre>
<p>&#x4F60;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5E8F;&#x5217;&#x7EC4;&#x5408;&#x6765;&#x6784;&#x6210;&#x591A;&#x4E2A;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#x6D41;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> sq1 = ASQ.react( .. ).seq( .. ).then( .. );
<span class="hljs-keyword">var</span> sq2 = ASQ.react( .. ).seq( .. ).then( .. );

<span class="hljs-keyword">var</span> sq3 = ASQ.react(..)
.gate(
    sq1,
    sq2
)
.then( .. );
</code></pre>
<p>&#x8FD9;&#x91CC;&#x7684;&#x8981;&#x70B9;&#x662F;&#xFF0C;<code>ASQ.react(..)</code>&#x662F;&#x4E00;&#x4E2A;F/RP&#x6982;&#x5FF5;&#x7684;&#x8F7B;&#x91CF;&#x7EA7;&#x9002;&#x914D;&#xFF0C;&#x4F7F;&#x5F97;&#x5C06;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x6D41;&#x4E0E;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x7684;&#x8FDE;&#x63A5;&#x6210;&#x4E3A;&#x53EF;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x5F97;&#x540D;&#x201C;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#x201D;&#x3002;&#x5BF9;&#x4E8E;&#x57FA;&#x672C;&#x7684;&#x54CD;&#x5E94;&#x5F0F;&#x7528;&#x6CD5;&#xFF0C;&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;&#x7684;&#x80FD;&#x529B;&#x901A;&#x5E38;&#x662F;&#x8DB3;&#x591F;&#x7684;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong> &#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;<code>ASQ.react(..)</code>&#x6765;&#x7BA1;&#x7406;UI&#x72B6;&#x6001;&#x7684;&#x4F8B;&#x5B50;(<a href="http://jsbin.com/rozipaki/6/edit?js,output)&#xFF0C;&#x548C;&#x53E6;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;`ASQ.react(..)`&#x6765;&#x5904;&#x7406;HTTP&#x8BF7;&#x6C42;/&#x5E94;&#x7B54;&#x6D41;&#x7684;&#x4F8B;&#x5B50;(https://gist.github.com/getify/bba5ec0de9d6047b720e)&#x3002;" target="_blank">http://jsbin.com/rozipaki/6/edit?js,output)&#xFF0C;&#x548C;&#x53E6;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;`ASQ.react(..)`&#x6765;&#x5904;&#x7406;HTTP&#x8BF7;&#x6C42;/&#x5E94;&#x7B54;&#x6D41;&#x7684;&#x4F8B;&#x5B50;(https://gist.github.com/getify/bba5ec0de9d6047b720e)&#x3002;</a></p>
<h2 id="generator-&#x534F;&#x7A0B;">Generator &#x534F;&#x7A0B;</h2>
<p>&#x5E0C;&#x671B;&#x7B2C;&#x56DB;&#x7AE0;&#x5E2E;&#x52A9;&#x4F60;&#x5F88;&#x597D;&#x5730;&#x719F;&#x6089;&#x4E86;ES6 generator&#x3002;&#x7279;&#x522B;&#x5730;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x91CD;&#x6E29;&#x5E76;&#x66F4;&#x52A0;&#x6DF1;&#x5165;&#x201C;Generator &#x5E76;&#x53D1;&#x6027;&#x201D;&#x7684;&#x8BA8;&#x8BBA;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x60F3;&#x8C61;&#x4E86;&#x4E00;&#x4E2A;<code>runAll(..)</code>&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x4E24;&#x4E2A;&#x6216;&#x66F4;&#x591A;&#x7684; generator &#x5E76;&#x4E14;&#x5E76;&#x53D1;&#x5730;&#x8FD0;&#x884C;&#x5B83;&#x4EEC;&#xFF0C;&#x8BA9;&#x5B83;&#x4EEC;&#x534F;&#x4F5C;&#x5730;&#x5C06;&#x63A7;&#x5236;&#x6743;&#x4ECE;&#x4E00;&#x4E2A;<code>yield</code>&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#xFF0C;&#x5E76;&#x5E26;&#x6709;&#x53EF;&#x9009;&#x7684;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x3002;</p>
<p>&#x9664;&#x4E86;&#x80FD;&#x591F;&#x5C06;&#x4E00;&#x4E2A; generator &#x8FD0;&#x884C;&#x81F3;&#x5B8C;&#x6210;&#x4E4B;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x9644;&#x5F55;A&#x4E2D;&#x8C08;&#x8BBA;&#x8FC7;&#x7684;<code>AQS#runner(..)</code>&#x662F;&#x4E00;&#x4E2A;<code>runAll(..)</code>&#x6982;&#x5FF5;&#x7684;&#x8FD1;&#x4F3C;&#x5B9E;&#x73B0;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5C06;&#x591A;&#x4E2A; generator &#x5E76;&#x53D1;&#x5730;&#x8FD0;&#x884C;&#x81F3;&#x5B8C;&#x6210;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7B2C;&#x56DB;&#x7AE0;&#x7684;&#x5E76;&#x53D1;Ajax&#x573A;&#x666F;&#xFF1A;</p>
<pre><code class="lang-js">ASQ(
    <span class="hljs-string">&quot;http://some.url.2&quot;</span>
)
.runner(
    <span class="hljs-function"><span class="hljs-keyword">function</span>*(<span class="hljs-params">token</span>)</span>{
        <span class="hljs-comment">// &#x8F6C;&#x79FB;&#x63A7;&#x5236;&#x6743;</span>
        <span class="hljs-keyword">yield</span> token;

        <span class="hljs-keyword">var</span> url1 = token.messages[<span class="hljs-number">0</span>]; <span class="hljs-comment">// &quot;http://some.url.1&quot;</span>

        <span class="hljs-comment">// &#x6E05;&#x7A7A;&#x6D88;&#x606F;&#x91CD;&#x65B0;&#x5F00;&#x59CB;</span>
        token.messages = [];

        <span class="hljs-keyword">var</span> p1 = request( url1 );

        <span class="hljs-comment">// &#x8F6C;&#x79FB;&#x63A7;&#x5236;&#x6743;</span>
        <span class="hljs-keyword">yield</span> token;

        token.messages.push( <span class="hljs-keyword">yield</span> p1 );
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span>*(<span class="hljs-params">token</span>)</span>{
        <span class="hljs-keyword">var</span> url2 = token.messages[<span class="hljs-number">0</span>]; <span class="hljs-comment">// &quot;http://some.url.2&quot;</span>

        <span class="hljs-comment">// &#x4F20;&#x9012;&#x6D88;&#x606F;&#x5E76;&#x8F6C;&#x79FB;&#x63A7;&#x5236;&#x6743;</span>
        token.messages[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;http://some.url.1&quot;</span>;
        <span class="hljs-keyword">yield</span> token;

        <span class="hljs-keyword">var</span> p2 = request( url2 );

        <span class="hljs-comment">// &#x79FB;&#x63A7;&#x5236;&#x6743;</span>
        <span class="hljs-keyword">yield</span> token;

        token.messages.push( <span class="hljs-keyword">yield</span> p2 );

        <span class="hljs-comment">// &#x8BB2;&#x7ED3;&#x679C;&#x4F20;&#x9012;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x6B65;&#x9AA4;</span>
        <span class="hljs-keyword">return</span> token.messages;
    }
)
.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
    <span class="hljs-comment">// `res[0]` comes from &quot;http://some.url.1&quot;</span>
    <span class="hljs-comment">// `res[1]` comes from &quot;http://some.url.2&quot;</span>
} );
</code></pre>
<p>&#x4EE5;&#x4E0B;&#x662F;<code>ASQ#runner(..)</code>&#x548C;<code>runAll(..)</code>&#x4E4B;&#x95F4;&#x7684;&#x4E3B;&#x8981;&#x4E0D;&#x540C;&#xFF1A;</p>
<ul>
<li>&#x6BCF;&#x4E2A; generator&#xFF08;&#x534F;&#x7A0B;&#xFF09;&#x90FD;&#x88AB;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x79F0;&#x4E3A;<code>token</code>&#x7684;&#x53C2;&#x6570;&#x503C;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x5F53;&#x4F60;&#x60F3;&#x8981;&#x660E;&#x786E;&#x5730;&#x5C06;&#x63A7;&#x5236;&#x6743;&#x4F20;&#x9012;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#x65F6;<code>yield</code>&#x7528;&#x7684;&#x7279;&#x6B8A;&#x503C;&#x3002;</li>
<li><code>token.messages</code>&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x6301;&#x6709;&#x4ECE;&#x524D;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x6B65;&#x9AA4;&#x4E2D;&#x4F20;&#x5165;&#x7684;&#x4EFB;&#x4F55;&#x6D88;&#x606F;&#x3002;&#x5B83;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5728;&#x534F;&#x7A0B;&#x4E4B;&#x95F4;&#x5206;&#x4EAB;&#x6D88;&#x606F;&#x3002;</li>
<li><code>yield</code>&#x4E00;&#x4E2A; Promise&#xFF08;&#x6216;&#x5E8F;&#x5217;&#xFF09;&#x503C;&#x4E0D;&#x4F1A;&#x4F20;&#x9012;&#x63A7;&#x5236;&#x6743;&#xFF0C;&#x4F46;&#x4F1A;&#x6682;&#x505C;&#x8FD9;&#x4E2A;&#x534F;&#x7A0B;&#x5904;&#x7406;&#x76F4;&#x5230;&#x8FD9;&#x4E2A;&#x503C;&#x51C6;&#x5907;&#x597D;&#x3002;</li>
<li>&#x8FD9;&#x4E2A;&#x534F;&#x7A0B;&#x5904;&#x7406;&#x8FD0;&#x884C;&#x5230;&#x6700;&#x540E;<code>return</code>&#x6216;<code>yield</code>&#x7684;&#x503C;&#x5C06;&#x4F1A;&#x4F20;&#x9012;&#x7ED9;&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#x3002;</li>
</ul>
<p>&#x4E3A;&#x4E86;&#x9002;&#x5E94;&#x4E0D;&#x540C;&#x7684;&#x7528;&#x6CD5;&#xFF0C;&#x5728;<code>ASQ#runner(..)</code>&#x529F;&#x80FD;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5305;&#x88C5;&#x4E00;&#x5C42;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x4E5F;&#x5F88;&#x5BB9;&#x6613;&#x3002;</p>
<h3 id="&#x72B6;&#x6001;&#x673A;">&#x72B6;&#x6001;&#x673A;</h3>
<p>&#x8BB8;&#x591A;&#x7A0B;&#x5E8F;&#x5458;&#x53EF;&#x80FD;&#x5F88;&#x719F;&#x6089;&#x7684;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x72B6;&#x6001;&#x673A;&#x3002;&#x5728;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x5305;&#x88C5;&#x5DE5;&#x5177;&#x7684;&#x5E2E;&#x52A9;&#x4E0B;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x521B;&#x4E00;&#x4E2A;&#x6613;&#x4E8E;&#x8868;&#x8FBE;&#x7684;&#x72B6;&#x6001;&#x673A;&#x5904;&#x7406;&#x5668;&#x3002;</p>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x60F3;&#x8C61;&#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x5DE5;&#x5177;&#x3002;&#x6211;&#x4EEC;&#x79F0;&#x4E4B;&#x4E3A;<code>state(..)</code>&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F20;&#x9012;&#x7ED9;&#x5B83;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x503C;&#xFF1A;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x503C;&#x548C;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x7684; generator&#x3002;<code>state(..)</code>&#x5C06;&#x62C5;&#x8D1F;&#x8D77;&#x521B;&#x5EFA;&#x5E76;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x9002;&#x914D;&#x5668; generator &#x7684;&#x810F;&#x6D3B;&#xFF0C;&#x5E76;&#x628A;&#x5B83;&#x4F20;&#x9012;&#x7ED9;<code>ASQ#runner(..)</code>&#x3002;</p>
<p>&#x8003;&#x8651;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">state</span>(<span class="hljs-params">val,handler</span>) </span>{
    <span class="hljs-comment">// &#x4E3A;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x5236;&#x9020;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#x5904;&#x7406;&#x5668;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>*(<span class="hljs-params">token</span>) </span>{
        <span class="hljs-comment">// &#x72B6;&#x6001;&#x8F6C;&#x6362;&#x5904;&#x7406;&#x5668;</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">transition</span>(<span class="hljs-params">to</span>) </span>{
            token.messages[<span class="hljs-number">0</span>] = to;
        }

        <span class="hljs-comment">// &#x8BBE;&#x7F6E;&#x521D;&#x59CB;&#x72B6;&#x6001;&#xFF08;&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x7684;&#x8BDD;&#xFF09;</span>
        <span class="hljs-keyword">if</span> (token.messages.length &lt; <span class="hljs-number">1</span>) {
            token.messages[<span class="hljs-number">0</span>] = val;
        }

        <span class="hljs-comment">// &#x6301;&#x7EED;&#x8FD0;&#x884C;&#x76F4;&#x5230;&#x6700;&#x7EC8;&#x72B6;&#x6001;&#xFF08;false&#xFF09;</span>
        <span class="hljs-keyword">while</span> (token.messages[<span class="hljs-number">0</span>] !== <span class="hljs-literal">false</span>) {
            <span class="hljs-comment">// &#x5F53;&#x524D;&#x7684;&#x72B6;&#x6001;&#x5339;&#x914D;&#x8FD9;&#x4E2A;&#x5904;&#x7406;&#x5668;&#x5417;&#xFF1F;</span>
            <span class="hljs-keyword">if</span> (token.messages[<span class="hljs-number">0</span>] === val) {
                <span class="hljs-comment">// &#x59D4;&#x6258;&#x5230;&#x72B6;&#x6001;&#x5904;&#x7406;&#x5668;</span>
                <span class="hljs-keyword">yield</span> *handler( transition );
            }

            <span class="hljs-comment">// &#x8981;&#x628A;&#x63A7;&#x5236;&#x6743;&#x8F6C;&#x79FB;&#x7ED9;&#x53E6;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x5904;&#x7406;&#x5668;&#x5417;&#xFF1F;</span>
            <span class="hljs-keyword">if</span> (token.messages[<span class="hljs-number">0</span>] !== <span class="hljs-literal">false</span>) {
                <span class="hljs-keyword">yield</span> token;
            }
        }
    };
}
</code></pre>
<p>&#x5982;&#x679C;&#x4F60;&#x4ED4;&#x7EC6;&#x89C2;&#x5BDF;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;<code>state(..)</code>&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A;&#x63A5;&#x6536;<code>token</code>&#x7684; generator&#xFF0C;&#x7136;&#x540E;&#x5B83;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;<code>while</code>&#x5FAA;&#x73AF;&#xFF0C;&#x8FD9;&#x4E2A;&#x5FAA;&#x73AF;&#x4F1A;&#x8FD0;&#x884C;&#x5230;&#x72B6;&#x6001;&#x673A;&#x76F4;&#x5230;&#x5230;&#x8FBE;&#x5B83;&#x7684;&#x6700;&#x7EC8;&#x72B6;&#x6001;&#xFF08;&#x6211;&#x4EEC;&#x968F;&#x610F;&#x5730;&#x5C06;&#x5B83;&#x9009;&#x5B9A;&#x4E3A;<code>false</code>&#x503C;&#xFF09;&#x4E3A;&#x6B62;&#xFF1B;&#x8FD9;&#x6B63;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x4F20;&#x9012;&#x7ED9;<code>ASQ#runner(..)</code>&#x7684;&#x90A3;&#x79CD; generator&#xFF01;</p>
<p>&#x6211;&#x4EEC;&#x8FD8;&#x968F;&#x610F;&#x5730;&#x4FDD;&#x7559;&#x4E86;<code>token.messages[0]</code>&#x503C;&#x69FD;&#xFF0C;&#x653E;&#x7F6E;&#x6211;&#x4EEC;&#x7684;&#x72B6;&#x6001;&#x673A;&#x5C06;&#x8981;&#x8FFD;&#x8E2A;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x6211;&#x4EEC;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x521D;&#x59CB;&#x72B6;&#x6001;&#xFF0C;&#x4F5C;&#x4E3A;&#x5E8F;&#x5217;&#x4E2D;&#x524D;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#x4F20;&#x9012;&#x6765;&#x7684;&#x503C;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5982;&#x4F55;&#x5C06;<code>state(..)</code>&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x4E0E;<code>ASQ#runner(..)</code>&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x5462;&#xFF1F;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> prevState;

ASQ(
    <span class="hljs-comment">/* &#x53EF;&#x9009;&#x7684;&#xFF1A;&#x521D;&#x59CB;&#x72B6;&#x6001;&#x503C; */</span>
    <span class="hljs-number">2</span>
)
<span class="hljs-comment">// &#x8FD0;&#x884C;&#x6211;&#x4EEC;&#x7684;&#x72B6;&#x6001;&#x673A;</span>
<span class="hljs-comment">// &#x8F6C;&#x6362;&#x662F;&#xFF1A;2 -&gt; 3 -&gt; 1 -&gt; 3 -&gt; false</span>
.runner(
    <span class="hljs-comment">// &#x72B6;&#x6001; `1` &#x5904;&#x7406;&#x5668;</span>
    state( <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> *<span class="hljs-title">stateOne</span>(<span class="hljs-params">transition</span>)</span>{
        <span class="hljs-built_in">console</span>.log( <span class="hljs-string">&quot;in state 1&quot;</span> );

        prevState = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">yield</span> transition( <span class="hljs-number">3</span> );    <span class="hljs-comment">// &#x524D;&#x5F80;&#x72B6;&#x6001; `3`</span>
    } ),

    <span class="hljs-comment">// &#x72B6;&#x6001; `2` &#x5904;&#x7406;&#x5668;</span>
    state( <span class="hljs-number">2</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> *<span class="hljs-title">stateTwo</span>(<span class="hljs-params">transition</span>)</span>{
        <span class="hljs-built_in">console</span>.log( <span class="hljs-string">&quot;in state 2&quot;</span> );

        prevState = <span class="hljs-number">2</span>;
        <span class="hljs-keyword">yield</span> transition( <span class="hljs-number">3</span> );    <span class="hljs-comment">// &#x524D;&#x5F80;&#x72B6;&#x6001; `3`</span>
    } ),

    <span class="hljs-comment">// &#x72B6;&#x6001; `3` &#x5904;&#x7406;&#x5668;</span>
    state( <span class="hljs-number">3</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> *<span class="hljs-title">stateThree</span>(<span class="hljs-params">transition</span>)</span>{
        <span class="hljs-built_in">console</span>.log( <span class="hljs-string">&quot;in state 3&quot;</span> );

        <span class="hljs-keyword">if</span> (prevState === <span class="hljs-number">2</span>) {
            prevState = <span class="hljs-number">3</span>;
            <span class="hljs-keyword">yield</span> transition( <span class="hljs-number">1</span> ); <span class="hljs-comment">// &#x524D;&#x5F80;&#x72B6;&#x6001; `1`</span>
        }
        <span class="hljs-comment">// &#x5B8C;&#x6210;&#x4E86;&#xFF01;</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;That&apos;s all folks!&quot;</span>;

            prevState = <span class="hljs-number">3</span>;
            <span class="hljs-keyword">yield</span> transition( <span class="hljs-literal">false</span> ); <span class="hljs-comment">// &#x7EC8;&#x6B62;&#x72B6;&#x6001;</span>
        }
    } )
)
<span class="hljs-comment">// &#x72B6;&#x6001;&#x673A;&#x8FD0;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x6240;&#x4EE5;&#x7EE7;&#x7EED;</span>
.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>)</span>{
    <span class="hljs-built_in">console</span>.log( msg );    <span class="hljs-comment">// That&apos;s all folks!</span>
} );
</code></pre>
<p>&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;<code>*stateOne(..)</code>&#xFF0C;<code>*stateTwo(..)</code>&#xFF0C;&#x548C;<code>*stateThree(..)</code> generator &#x672C;&#x8EAB;&#x4F1A;&#x5728;&#x6BCF;&#x6B21;&#x8FDB;&#x5165;&#x90A3;&#x79CD;&#x72B6;&#x6001;&#x65F6;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x5B83;&#x4EEC;&#x4F1A;&#x5728;&#x4F60;<code>transition(..)</code>&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x503C;&#x65F6;&#x5B8C;&#x6210;&#x3002;&#x867D;&#x7136;&#x6CA1;&#x6709;&#x5728;&#x8FD9;&#x91CC;&#x5C55;&#x793A;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x72B6;&#x6001; generator &#x5904;&#x7406;&#x5668;&#x7406;&#x6240;&#x5F53;&#x7136;&#x5730;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>yield</code> Promise/&#x5E8F;&#x5217;/thunk &#x6765;&#x5F02;&#x6B65;&#x5730;&#x6682;&#x505C;&#x3002;</p>
<p>&#x9690;&#x85CF;&#x5728;&#x5E95;&#x5C42;&#x7684; generator &#x662F;&#x7531;<code>state(..)</code>&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x4EA7;&#x751F;&#x7684;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x88AB;&#x4F20;&#x9012;&#x7ED9;<code>ASQ#runner(..)</code>&#x7684; generator &#x662F;&#x6301;&#x7EED;&#x5E76;&#x53D1;&#x8FD0;&#x884C;&#x81F3;&#x72B6;&#x6001;&#x673A;&#x957F;&#x5EA6;&#x7684;&#x90A3;&#x4E00;&#x4E2A;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x90FD;&#x534F;&#x4F5C;&#x5730;&#x5C06;&#x63A7;&#x5236;&#x6743;<code>yield</code>&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A;&#xFF0C;&#x5982;&#x6B64;&#x7C7B;&#x63A8;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong> &#x770B;&#x770B;&#x8FD9;&#x4E2A;&#x201C;&#x4E52;&#x4E53;&#x201D;&#x7684;&#x4F8B;&#x5B50;(<a href="http://jsbin.com/qutabu/1/edit?js,output)&#xFF0C;&#x5B83;&#x5C55;&#x793A;&#x4E86;&#x7531;`ASQ#runner(..)`&#x9A71;&#x52A8;&#x7684;" target="_blank">http://jsbin.com/qutabu/1/edit?js,output)&#xFF0C;&#x5B83;&#x5C55;&#x793A;&#x4E86;&#x7531;`ASQ#runner(..)`&#x9A71;&#x52A8;&#x7684;</a> generator &#x7684;&#x534F;&#x4F5C;&#x5E76;&#x53D1;&#x7684;&#x7528;&#x6CD5;&#x3002;</p>
<h2 id="&#x901A;&#x4FE1;&#x5E8F;&#x5217;&#x5316;&#x5904;&#x7406;&#xFF08;csp&#xFF09;">&#x901A;&#x4FE1;&#x5E8F;&#x5217;&#x5316;&#x5904;&#x7406;&#xFF08;CSP&#xFF09;</h2>
<p>&#x201C;&#x901A;&#x4FE1;&#x5E8F;&#x5217;&#x5316;&#x5904;&#x7406;&#xFF08;Communicating Sequential Processes &#x2014;&#x2014; CSP&#xFF09;&#x201D;&#x662F;&#x7531; C. A. R. Hoare &#x5728;1978&#x5E74;&#x7684;&#x4E00;&#x7BC7;&#x5B66;&#x672F;&#x8BBA;&#x6587;(<a href="http://dl.acm.org/citation.cfm?doid=359576.359585)&#x4E2D;&#x9996;&#x5148;&#x88AB;&#x63D0;&#x51FA;&#x7684;&#xFF0C;&#x540E;&#x6765;&#x5728;1985&#x5E74;&#x7684;&#x4E00;&#x672C;&#x540C;&#x540D;&#x4E66;&#x7C4D;&#x4E2D;&#x88AB;&#x63CF;&#x8FF0;&#x8FC7;&#x3002;CSP&#x63CF;&#x8FF0;&#x4E86;&#x4E00;&#x79CD;&#x5E76;&#x53D1;&#x201C;&#x8FDB;&#x7A0B;&#x201D;&#x5728;&#x5904;&#x7406;&#x671F;&#x95F4;&#x8FDB;&#x884C;&#x4E92;&#x52A8;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x201C;&#x901A;&#x4FE1;&#x201D;&#xFF09;&#x7684;&#x5F62;&#x5F0F;&#x65B9;&#x6CD5;&#x3002;" target="_blank">http://dl.acm.org/citation.cfm?doid=359576.359585)&#x4E2D;&#x9996;&#x5148;&#x88AB;&#x63D0;&#x51FA;&#x7684;&#xFF0C;&#x540E;&#x6765;&#x5728;1985&#x5E74;&#x7684;&#x4E00;&#x672C;&#x540C;&#x540D;&#x4E66;&#x7C4D;&#x4E2D;&#x88AB;&#x63CF;&#x8FF0;&#x8FC7;&#x3002;CSP&#x63CF;&#x8FF0;&#x4E86;&#x4E00;&#x79CD;&#x5E76;&#x53D1;&#x201C;&#x8FDB;&#x7A0B;&#x201D;&#x5728;&#x5904;&#x7406;&#x671F;&#x95F4;&#x8FDB;&#x884C;&#x4E92;&#x52A8;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x201C;&#x901A;&#x4FE1;&#x201D;&#xFF09;&#x7684;&#x5F62;&#x5F0F;&#x65B9;&#x6CD5;&#x3002;</a></p>
<p>&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x56DE;&#x5FC6;&#x8D77;&#x6211;&#x4EEC;&#x5728;&#x7B2C;&#x4E00;&#x7AE0;&#x68C0;&#x89C6;&#x8FC7;&#x7684;&#x5E76;&#x53D1;&#x201C;&#x8FDB;&#x7A0B;&#x201D;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5BF9;CSP&#x7684;&#x63A2;&#x7D22;&#x5C06;&#x4F1A;&#x5EFA;&#x7ACB;&#x5728;&#x90A3;&#x79CD;&#x7406;&#x89E3;&#x4E4B;&#x4E0A;&#x3002;</p>
<p>&#x5C31;&#x50CF;&#x5927;&#x591A;&#x6570;&#x8BA1;&#x7B97;&#x673A;&#x79D1;&#x5B66;&#x4E2D;&#x7684;&#x4F1F;&#x5927;&#x6982;&#x5FF5;&#x4E00;&#x6837;&#xFF0C;CSP&#x6DF1;&#x6DF1;&#x5730;&#x6C89;&#x6D78;&#x5728;&#x5B66;&#x672F;&#x5F62;&#x5F0F;&#x4E3B;&#x610F;&#x4E2D;&#xFF0C;&#x88AB;&#x8868;&#x8FBE;&#x4E3A;&#x4E00;&#x79CD;&#x4EE3;&#x6570;&#x5904;&#x7406;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x6211;&#x6000;&#x7591;&#x6EE1;&#x662F;&#x7B26;&#x53F7;&#x7684;&#x4EE3;&#x6570;&#x5B9A;&#x7406;&#x4E0D;&#x4F1A;&#x7ED9;&#x8BFB;&#x8005;&#x5E26;&#x6765;&#x592A;&#x591A;&#x5B9E;&#x9645;&#x610F;&#x4E49;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C06;&#x627E;&#x5176;&#x4ED6;&#x7684;&#x65B9;&#x6CD5;&#x5C06;CSP&#x5E26;&#x8FDB;&#x6211;&#x4EEC;&#x7684;&#x5927;&#x8111;&#x3002;</p>
<p>&#x6211;&#x4F1A;&#x5C06;&#x5F88;&#x591A;CSP&#x7684;&#x5F62;&#x5F0F;&#x63CF;&#x8FF0;&#x548C;&#x8BC1;&#x660E;&#x7559;&#x7ED9; Hoare &#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x4E0E;&#x5176;&#x4ED6;&#x8BB8;&#x591A;&#x7F8E;&#x5999;&#x7684;&#x76F8;&#x5173;&#x4F5C;&#x54C1;&#x3002;&#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5C3D;&#x53EF;&#x80FD;&#x4EE5;&#x4E00;&#x79CD;&#x975E;&#x5B66;&#x9662;&#x6D3E;&#x7684;&#x3001;&#x4F46;&#x613F;&#x662F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7406;&#x89E3;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6765;&#x8BD5;&#x7740;&#x7B80;&#x8981;&#x5730;&#x8BB2;&#x89E3;CSP&#x7684;&#x601D;&#x60F3;&#x3002;</p>
<h3 id="&#x6D88;&#x606F;&#x4F20;&#x9012;">&#x6D88;&#x606F;&#x4F20;&#x9012;</h3>
<p>CSP&#x7684;&#x6838;&#x5FC3;&#x539F;&#x5219;&#x662F;&#xFF0C;&#x5728;&#x72EC;&#x7ACB;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;/&#x4E92;&#x52A8;&#x90FD;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x6B63;&#x5F0F;&#x7684;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x3002;&#x4E5F;&#x8BB8;&#x4E0E;&#x4F60;&#x7684;&#x671F;&#x671B;&#x80CC;&#x9053;&#x800C;&#x9A70;&#xFF0C;CSP&#x7684;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x662F;&#x4F5C;&#x4E3A;&#x540C;&#x6B65;&#x884C;&#x4E3A;&#x8FDB;&#x884C;&#x63CF;&#x8FF0;&#x7684;&#xFF0C;&#x53D1;&#x9001;&#x8FDB;&#x7A0B;&#x4E0E;&#x63A5;&#x6536;&#x8FDB;&#x7A0B;&#x90FD;&#x4E0D;&#x5F97;&#x4E0D;&#x4E3A;&#x6D88;&#x606F;&#x7684;&#x4F20;&#x9012;&#x505A;&#x597D;&#x51C6;&#x5907;&#x3002;</p>
<p>&#x8FD9;&#x6837;&#x7684;&#x540C;&#x6B65;&#x6D88;&#x606F;&#x600E;&#x4E48;&#x4F1A;&#x4E0E; JavaScript &#x4E2D;&#x7684;&#x5F02;&#x6B65;&#x7F16;&#x7A0B;&#x6709;&#x8054;&#x7CFB;&#xFF1F;</p>
<p>&#x8FD9;&#x79CD;&#x8054;&#x7CFB;&#x5177;&#x4F53;&#x6765;&#x81EA;&#x4E8E; ES6 generator &#x7684;&#x6027;&#x8D28; &#x2014;&#x2014; generator &#x88AB;&#x7528;&#x4E8E;&#x751F;&#x4EA7;&#x770B;&#x4F3C;&#x540C;&#x6B65;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x884C;&#x4E3A;&#x7684;&#x5185;&#x90E8;&#x65E2;&#x53EF;&#x4EE5;&#x662F;&#x540C;&#x6B65;&#x7684;&#x4E5F;&#x53EF;&#x4EE5;&#xFF08;&#x66F4;&#x53EF;&#x80FD;&#xFF09;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x3002;</p>
<p>&#x6362;&#x8A00;&#x4E4B;&#xFF0C;&#x4E24;&#x4E2A;&#x6216;&#x66F4;&#x591A;&#x5E76;&#x53D1;&#x8FD0;&#x884C;&#x7684; generator &#x53EF;&#x80FD;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x662F;&#x5728;&#x4E92;&#x76F8;&#x540C;&#x6B65;&#x5730;&#x4F20;&#x9012;&#x6D88;&#x606F;&#xFF0C;&#x800C;&#x540C;&#x65F6;&#x4FDD;&#x7559;&#x4E86;&#x7CFB;&#x7EDF;&#x7684;&#x5F02;&#x6B65;&#x6027;&#x57FA;&#x7840;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A; generator &#x7684;&#x4EE3;&#x7801;&#x90FD;&#x4F1A;&#x88AB;&#x6682;&#x505C;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x201C;&#x963B;&#x585E;&#x201D;&#xFF09;&#x6765;&#x7B49;&#x5F85;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x52A8;&#x4F5C;&#x7684;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF1F;</p>
<p>&#x60F3;&#x8C61;&#x4E00;&#x4E2A;&#x79F0;&#x4E3A;&#x201C;A&#x201D;&#x7684; generator&#xFF0C;&#x5B83;&#x60F3;&#x8981;&#x7ED9; generator &#x201C;B&#x201D; &#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x201C;A&#x201D; <code>yield</code>&#x51FA;&#x8981;&#x53D1;&#x9001;&#x7ED9;&#x201C;B&#x201D;&#x7684;&#x6D88;&#x606F;&#xFF08;&#x56E0;&#x6B64;&#x6682;&#x505C;&#x4E86;&#x201C;A&#x201D;&#xFF09;&#x3002;&#x5F53;&#x201C;B&#x201D;&#x51C6;&#x5907;&#x597D;&#x5E76;&#x62FF;&#x8D70;&#x8FD9;&#x4E2A;&#x6D88;&#x606F;&#x65F6;&#xFF0C;&#x201C;A&#x201D;&#x624D;&#x4F1A;&#x7EE7;&#x7EED;&#xFF08;&#x89E3;&#x9664;&#x963B;&#x585E;&#xFF09;&#x3002;</p>
<p>&#x4E0E;&#x6B64;&#x5BF9;&#x79F0;&#x7684;&#xFF0C;&#x60F3;&#x8C61;&#x4E00;&#x4E2A; generator &#x201C;A&#x201D;&#x60F3;&#x8981; <strong>&#x4ECE;</strong> &#x201C;B&#x201D;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x3002;&#x201C;A&#x201D; <code>yield</code>&#x51FA;&#x4E00;&#x4E2A;&#x4ECE;&#x201C;B&#x201D;&#x53D6;&#x5F97;&#x6D88;&#x606F;&#x7684;&#x8BF7;&#x6C42;&#xFF08;&#x56E0;&#x6B64;&#x6682;&#x505C;&#x4E86;&#x201C;A&#x201D;&#xFF09;&#xFF0C;&#x4E00;&#x65E6;&#x201C;B&#x201D;&#x53D1;&#x9001;&#x4E86;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#xFF0C;&#x201C;A&#x201D;&#x5C31;&#x62FF;&#x6765;&#x8FD9;&#x4E2A;&#x6D88;&#x606F;&#x5E76;&#x7EE7;&#x7EED;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;CSP&#x6D88;&#x606F;&#x4F20;&#x9012;&#x7406;&#x8BBA;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x66F4;&#x5E7F;&#x4E3A;&#x4EBA;&#x77E5;&#x7684;&#x8868;&#x8FBE;&#x5F62;&#x5F0F;&#x662F; ClojureScript &#x7684; core.async &#x5E93;&#xFF0C;&#x4EE5;&#x53CA; <em>go</em> &#x8BED;&#x8A00;&#x3002;&#x5B83;&#x4EEC;&#x5C06;CSP&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x901A;&#x4FE1;&#x8BED;&#x4E49;&#x5B9E;&#x73B0;&#x4E3A;&#x4E00;&#x79CD;&#x5728;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x6253;&#x5F00;&#x7684;&#x7BA1;&#x9053;&#xFF0C;&#x79F0;&#x4E3A;&#x201C;&#x9891;&#x9053;&#xFF08;channel&#xFF09;&#x201D;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong> <em>&#x9891;&#x9053;</em> &#x8FD9;&#x4E2A;&#x672F;&#x8BED;&#x63CF;&#x8FF0;&#x4E86;&#x95EE;&#x9898;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x56E0;&#x4E3A;&#x5B58;&#x5728;&#x4E00;&#x79CD;&#x6A21;&#x5F0F;&#xFF0C;&#x4F1A;&#x6709;&#x591A;&#x4E8E;&#x4E00;&#x4E2A;&#x7684;&#x503C;&#x88AB;&#x4E00;&#x6B21;&#x6027;&#x53D1;&#x9001;&#x5230;&#x8FD9;&#x4E2A;&#x9891;&#x9053;&#x7684;&#x201C;&#x7F13;&#x51B2;&#x201D;&#x4E2D;&#xFF1B;&#x8FD9;&#x4E0E;&#x4F60;&#x5BF9;&#x6D41;&#x7684;&#x8BA4;&#x8BC6;&#x76F8;&#x4F3C;&#x3002;&#x6211;&#x4EEC;&#x4E0D;&#x4F1A;&#x5728;&#x8FD9;&#x91CC;&#x6DF1;&#x5165;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x6D41;&#x7684;&#x7BA1;&#x7406;&#x6765;&#x8BF4;&#x5B83;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5F3A;&#x5927;&#x7684;&#x6280;&#x672F;&#x3002;</p>
<p>&#x5728;CSP&#x6700;&#x7B80;&#x5355;&#x7684;&#x6982;&#x5FF5;&#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x5728;&#x201C;A&#x201D;&#x548C;&#x201C;B&#x201D;&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x7684;&#x9891;&#x9053;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x79F0;&#x4E3A;<code>take(..)</code>&#x7684;&#x963B;&#x585E;&#x65B9;&#x6CD5;&#x6765;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x4EE5;&#x53CA;&#x4E00;&#x4E2A;&#x79F0;&#x4E3A;<code>put(..)</code>&#x7684;&#x963B;&#x585E;&#x65B9;&#x6CD5;&#x6765;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x503C;&#x3002;</p>
<p>&#x5B83;&#x770B;&#x8D77;&#x6765;&#x53EF;&#x80FD;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> ch = channel();

<span class="hljs-function"><span class="hljs-keyword">function</span> *<span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> msg = <span class="hljs-keyword">yield</span> take( ch );

    <span class="hljs-built_in">console</span>.log( msg );
}

<span class="hljs-function"><span class="hljs-keyword">function</span> *<span class="hljs-title">bar</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">yield</span> put( ch, <span class="hljs-string">&quot;Hello World&quot;</span> );

    <span class="hljs-built_in">console</span>.log( <span class="hljs-string">&quot;message sent&quot;</span> );
}

run( foo );
run( bar );
<span class="hljs-comment">// Hello World</span>
<span class="hljs-comment">// &quot;message sent&quot;</span>
</code></pre>
<p>&#x5C06;&#x8FD9;&#x79CD;&#x7ED3;&#x6784;&#x5316;&#x7684;&#x3001;&#xFF08;&#x770B;&#x4F3C;&#xFF09;&#x540C;&#x6B65;&#x7684;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x4E92;&#x52A8;&#xFF0C;&#x4E0E;<code>ASQ#runner(..)</code>&#x901A;&#x8FC7;<code>token.messages</code>&#x6570;&#x7EC4;&#x4E0E;&#x534F;&#x4F5C;&#x7684;<code>yield</code>&#x63D0;&#x4F9B;&#x7684;&#x3001;&#x975E;&#x5F62;&#x5F0F;&#x5316;&#x4E0E;&#x975E;&#x7ED3;&#x6784;&#x5316;&#x7684;&#x6D88;&#x606F;&#x5171;&#x4EAB;&#x76F8;&#x6BD4;&#x8F83;&#x3002;&#x5B9E;&#x8D28;&#x4E0A;&#xFF0C;<code>yield put(..)</code>&#x662F;&#x4E00;&#x79CD;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x53D1;&#x9001;&#x503C;&#x5E76;&#x4E3A;&#x4E86;&#x4F20;&#x9012;&#x63A7;&#x5236;&#x6743;&#x800C;&#x6682;&#x505C;&#x6267;&#x884C;&#x7684;&#x5355;&#x4E00;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x524D;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#x5206;&#x5F00;&#x5B9E;&#x65BD;&#x3002;</p>
<p>&#x53E6;&#x5916;CSP&#x5F3A;&#x8C03;&#xFF0C;&#x4F60;&#x4E0D;&#x4F1A;&#x771F;&#x6B63;&#x660E;&#x786E;&#x5730;&#x201C;&#x4F20;&#x9012;&#x63A7;&#x5236;&#x6743;&#x201D;&#xFF0C;&#x800C;&#x662F;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x4F60;&#x7684;&#x5E76;&#x53D1;&#x8FC7;&#x7A0B;&#xFF1A;&#x8981;&#x4E48;&#x4E3A;&#x4E86;&#x4ECE;&#x9891;&#x9053;&#x4E2D;&#x63A5;&#x6536;&#x503C;&#x800C;&#x963B;&#x585E;&#xFF0C;&#x8981;&#x4E48;&#x4E3A;&#x4E86;&#x8BD5;&#x7740;&#x5411;&#x8FD9;&#x4E2A;&#x9891;&#x9053;&#x4E2D;&#x53D1;&#x9001;&#x503C;&#x800C;&#x963B;&#x585E;&#x3002;&#x8FD9;&#x79CD;&#x56F4;&#x7ED5;&#x7740;&#x6D88;&#x606F;&#x7684;&#x53D1;&#x9001;&#x6216;&#x63A5;&#x6536;&#x7684;&#x963B;&#x585E;&#xFF0C;&#x5C31;&#x662F;&#x4F60;&#x5982;&#x4F55;&#x5728;&#x534F;&#x7A0B;&#x4E4B;&#x95F4;&#x534F;&#x8C03;&#x884C;&#x4E3A;&#x5E8F;&#x5217;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong> &#x9884;&#x5148;&#x5949;&#x544A;&#xFF1A;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x975E;&#x5E38;&#x5F3A;&#x5927;&#xFF0C;&#x4F46;&#x8981;&#x4E60;&#x60EF;&#x5B83;&#x6709;&#x4E9B;&#x70E7;&#x8111;&#x3002;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x9700;&#x8981;&#x5B9E;&#x8DF5;&#x5B83;&#x4E00;&#x4E0B;&#xFF0C;&#x6765;&#x4E60;&#x60EF;&#x8FD9;&#x79CD;&#x534F;&#x8C03;&#x5E76;&#x53D1;&#x6027;&#x7684;&#x65B0;&#x7684;&#x601D;&#x8003;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x6709;&#x597D;&#x51E0;&#x4E2A;&#x4E86;&#x4E0D;&#x8D77;&#x7684;&#x5E93;&#x5DF2;&#x7ECF;&#x7528; JavaScript &#x5B9E;&#x73B0;&#x4E86;&#x8FD9;&#x79CD;&#x98CE;&#x683C;&#x7684;CSP&#xFF0C;&#x6700;&#x5F15;&#x4EBA;&#x6CE8;&#x76EE;&#x7684;&#x662F;&#x201C;js-csp&#x201D;(<a href="https://github.com/ubolonton/js-csp)&#xFF0C;&#x7531;" target="_blank">https://github.com/ubolonton/js-csp)&#xFF0C;&#x7531;</a> James Long (<a href="http://twitter.com/jlongster)&#x5F00;&#x51FA;&#x7684;&#x5206;&#x652F;(https://github.com/jlongster/js-csp)&#xFF0C;&#x4EE5;&#x53CA;&#x4ED6;&#x7279;&#x610F;&#x64B0;&#x5199;&#x7684;&#x4F5C;&#x54C1;(http://jlongster.com/Taming-the-Asynchronous-Beast-with-CSP-in-JavaScript)&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5173;&#x4E8E;&#x5C06;" target="_blank">http://twitter.com/jlongster)&#x5F00;&#x51FA;&#x7684;&#x5206;&#x652F;(https://github.com/jlongster/js-csp)&#xFF0C;&#x4EE5;&#x53CA;&#x4ED6;&#x7279;&#x610F;&#x64B0;&#x5199;&#x7684;&#x4F5C;&#x54C1;(http://jlongster.com/Taming-the-Asynchronous-Beast-with-CSP-in-JavaScript)&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5173;&#x4E8E;&#x5C06;</a> ClojureScript &#x4E2D; go &#x98CE;&#x683C;&#x7684; core.async CSP &#x9002;&#x914D;&#x5230; JS generator &#x7684;&#x8BDD;&#x9898;&#xFF0C;&#x65E0;&#x8BBA;&#x600E;&#x4E48;&#x5938;&#x8D5E; David Nolen (<a href="http://twitter.com/swannodette" target="_blank">http://twitter.com/swannodette</a>) &#x7684;&#x8BB8;&#x591A;&#x4F5C;&#x54C1;&#x5F88;&#x7CBE;&#x5F69;&#x90FD;&#x4E0D;&#x4E3A;&#x8FC7; (<a href="http://swannodette.github.io/2013/08/24/es6-generators-and-csp)&#x3002;" target="_blank">http://swannodette.github.io/2013/08/24/es6-generators-and-csp)&#x3002;</a></p>
<h3 id="asynquence-&#x7684;-csp-&#x6A21;&#x62DF;">asynquence &#x7684; CSP &#x6A21;&#x62DF;</h3>
<p>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x662F;&#x5728;&#x6211;&#x7684; <em>asynquence</em> &#x5E93;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x73AF;&#x5883;&#x4E2D;&#x8BA8;&#x8BBA;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x7684;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x8FD9;&#x4E2A;&#x8BDD;&#x9898;&#x5F88;&#x611F;&#x5174;&#x8DA3;&#xFF1A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x5728;<code>ASQ#runner(..)</code> generator &#x5904;&#x7406;&#x4E0A;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x6A21;&#x62DF;&#x5C42;&#xFF0C;&#x6765;&#x8FD1;&#x4E4E;&#x5B8C;&#x7F8E;&#x5730;&#x79FB;&#x690D;CSP&#x7684;API&#x548C;&#x884C;&#x4E3A;&#x3002;&#x8FD9;&#x4E2A;&#x6A21;&#x62DF;&#x5C42;&#x653E;&#x5728;&#x4E0E; <em>asynquence</em> &#x4E00;&#x8D77;&#x53D1;&#x653E;&#x7684; &#x201C;asynquence-contrib&#x201D;&#x5305;&#x7684;&#x53EF;&#x9009;&#x90E8;&#x5206;&#x3002;</p>
<p>&#x4E0E;&#x65E9;&#x5148;&#x7684;<code>state(..)</code>&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#xFF0C;<code>ASQ.csp.go(..)</code>&#x63A5;&#x6536;&#x4E00;&#x4E2A; generator &#x2014;&#x2014; &#x7528; go/core.async &#x7684;&#x672F;&#x8BED;&#x6765;&#x8BB2;&#xFF0C;&#x5B83;&#x79F0;&#x4E3A;&#x4E00;&#x4E2A; goroutine &#x2014;&#x2014; &#x5E76;&#x5C06;&#x5B83;&#x9002;&#x914D;&#x4E3A;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x4E0E;<code>ASQ#runner(..)</code>&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x7684;&#x65B0; generator&#x3002;</p>
<p>&#x4E0E;&#x88AB;&#x4F20;&#x5165;&#x4E00;&#x4E2A;<code>token</code>&#x4E0D;&#x540C;&#xFF0C;&#x4F60;&#x7684; goroutine &#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x521B;&#x5EFA;&#x597D;&#x7684;&#x9891;&#x9053;&#xFF08;&#x4E0B;&#x9762;&#x7684;<code>ch</code>&#xFF09;&#xFF0C;&#x8FD9;&#x4E2A;&#x9891;&#x9053;&#x4F1A;&#x88AB;&#x672C;&#x6B21;&#x8FD0;&#x884C;&#x7684;&#x6240;&#x6709; goroutine &#x5171;&#x4EAB;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>ASQ.csp.chan(..)</code>&#x521B;&#x5EFA;&#x66F4;&#x591A;&#x9891;&#x9053;&#xFF08;&#x8FD9;&#x901A;&#x5E38;&#x5341;&#x5206;&#x6709;&#x7528;&#xFF09;&#x3002;</p>
<p>&#x5728;CSP&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x9891;&#x9053;&#x6D88;&#x606F;&#x4F20;&#x9012;&#x4E0A;&#x7684;&#x963B;&#x585E;&#x4F5C;&#x4E3A;&#x6240;&#x6709;&#x5F02;&#x6B65;&#x6027;&#x7684;&#x6A21;&#x578B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x7B49;&#x5F85; Promise/&#x5E8F;&#x5217;/thunk &#x7684;&#x5B8C;&#x6210;&#x800C;&#x53D1;&#x751F;&#x7684;&#x963B;&#x585E;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x4E0E;<code>yield</code>&#x4ECE;<code>request(..)</code>&#x4E2D;&#x8FD4;&#x56DE;&#x7684; Promise &#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;<code>request(..)</code>&#x5E94;&#x5F53;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x9891;&#x9053;&#xFF0C;&#x4F60;&#x4ECE;&#x5B83;&#x90A3;&#x91CC;<code>take(..)</code>&#x4E00;&#x4E2A;&#x503C;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x5355;&#x503C;&#x9891;&#x9053;&#x5728;&#x8FD9;&#x79CD;&#x4E0A;&#x4E0B;&#x6587;&#x73AF;&#x5883;/&#x7528;&#x6CD5;&#x4E0A;&#x5927;&#x81F4;&#x4E0A;&#x4E0E;&#x4E00;&#x4E2A; Promise/&#x5E8F;&#x5217;&#x662F;&#x7B49;&#x4EF7;&#x7684;&#x3002;</p>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x5148;&#x5236;&#x9020;&#x4E00;&#x4E2A;&#x517C;&#x5BB9;&#x9891;&#x9053;&#x7248;&#x672C;&#x7684;<code>request(..)</code>&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">request</span>(<span class="hljs-params">url</span>) </span>{
    <span class="hljs-keyword">var</span> ch = ASQ.csp.channel();
    ajax( url ).then( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">content</span>)</span>{
        <span class="hljs-comment">// `putAsync(..)` &#x662F; `put(..)` &#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;</span>
        <span class="hljs-comment">// &#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x4E2A; generator &#x7684;&#x5916;&#x90E8;&#x4F7F;&#x7528;&#x3002;&#x5B83;&#x4E3A;&#x64CD;&#x4F5C;</span>
        <span class="hljs-comment">// &#x7684;&#x5B8C;&#x6210;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; promise&#x3002;&#x6211;&#x4EEC;&#x4E0D;&#x5728;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;</span>
        <span class="hljs-comment">// promise&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6709;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x503C;&#x88AB;</span>
        <span class="hljs-comment">// `taken(..)` &#x4E4B;&#x540E;&#x6536;&#x5230;&#x901A;&#x77E5;&#x3002;</span>
        ASQ.csp.putAsync( ch, content );
    } );
    <span class="hljs-keyword">return</span> ch;
}
</code></pre>
<p>&#x5728;&#x7B2C;&#x4E09;&#x7AE0;&#x4E2D;&#xFF0C;&#x201C;promisory&#x201D;&#x662F;&#x4E00;&#x4E2A;&#x751F;&#x4EA7; Promise &#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x7B2C;&#x56DB;&#x7AE0;&#x4E2D;&#x201C;thunkory&#x201D;&#x662F;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;thunk&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x6700;&#x540E;&#xFF0C;&#x5728;&#x9644;&#x5F55;A&#x4E2D;&#x6211;&#x4EEC;&#x53D1;&#x660E;&#x4E86;&#x201C;sequory&#x201D;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x5E8F;&#x5217;&#x7684;&#x5DE5;&#x5177;&#x3002;</p>
<p>&#x5F88;&#x81EA;&#x7136;&#x5730;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E3A;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x9891;&#x9053;&#x7684;&#x5DE5;&#x5177;&#x675C;&#x64B0;&#x4E00;&#x4E2A;&#x5BF9;&#x79F0;&#x7684;&#x672F;&#x8BED;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x8BA9;&#x6211;&#x4EEC;&#x4E0D;&#x51FA;&#x610F;&#x6599;&#x5730;&#x79F0;&#x5B83;&#x4E3A;&#x201C;chanory&#x201D;&#xFF08;&#x201C;channel&#x201D; + &#x201C;factory&#x201D;&#xFF09;&#x5427;&#x3002;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x7559;&#x7ED9;&#x8BFB;&#x8005;&#x7684;&#x7EC3;&#x4E60;&#xFF0C;&#x8BF7;&#x8BD5;&#x7740;&#x4EB2;&#x624B;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<code>channelify(..)</code>&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5C31;&#x50CF; <code>Promise.wrap(..)</code>/<code>promisify(..)</code>&#xFF08;&#x7B2C;&#x4E09;&#x7AE0;&#xFF09;&#xFF0C;<code>thunkify(..)</code>&#xFF08;&#x7B2C;&#x56DB;&#x7AE0;&#xFF09;&#xFF0C;&#x548C;<code>ASQ.wrap(..)</code>&#xFF08;&#x9644;&#x5F55;A&#xFF09;&#x4E00;&#x6837;&#x3002;</p>
<p>&#x5148;&#x8003;&#x8651;&#x8FD9;&#x4E2A;&#x4F7F;&#x7528; <em>asyquence</em> &#x98CE;&#x683C;CSP&#x7684;&#x5E76;&#x53D1;Ajax&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-js">ASQ()
.runner(
    ASQ.csp.go( <span class="hljs-function"><span class="hljs-keyword">function</span>*(<span class="hljs-params">ch</span>)</span>{
        <span class="hljs-keyword">yield</span> ASQ.csp.put( ch, <span class="hljs-string">&quot;http://some.url.2&quot;</span> );

        <span class="hljs-keyword">var</span> url1 = <span class="hljs-keyword">yield</span> ASQ.csp.take( ch );
        <span class="hljs-comment">// &quot;http://some.url.1&quot;</span>

        <span class="hljs-keyword">var</span> res1 = <span class="hljs-keyword">yield</span> ASQ.csp.take( request( url1 ) );

        <span class="hljs-keyword">yield</span> ASQ.csp.put( ch, res1 );
    } ),
    ASQ.csp.go( <span class="hljs-function"><span class="hljs-keyword">function</span>*(<span class="hljs-params">ch</span>)</span>{
        <span class="hljs-keyword">var</span> url2 = <span class="hljs-keyword">yield</span> ASQ.csp.take( ch );
        <span class="hljs-comment">// &quot;http://some.url.2&quot;</span>

        <span class="hljs-keyword">yield</span> ASQ.csp.put( ch, <span class="hljs-string">&quot;http://some.url.1&quot;</span> );

        <span class="hljs-keyword">var</span> res2 = <span class="hljs-keyword">yield</span> ASQ.csp.take( request( url2 ) );
        <span class="hljs-keyword">var</span> res1 = <span class="hljs-keyword">yield</span> ASQ.csp.take( ch );

        <span class="hljs-comment">// &#x8BB2;&#x7ED3;&#x679C;&#x4F20;&#x9012;&#x7ED9;&#x5E8F;&#x5217;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;</span>
        ch.buffer_size = <span class="hljs-number">2</span>;
        ASQ.csp.put( ch, res1 );
        ASQ.csp.put( ch, res2 );
    } )
)
.val( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res1,res2</span>)</span>{
    <span class="hljs-comment">// `res1` comes from &quot;http://some.url.1&quot;</span>
    <span class="hljs-comment">// `res2` comes from &quot;http://some.url.2&quot;</span>
} );
</code></pre>
<p>&#x6D88;&#x606F;&#x4F20;&#x9012;&#x5728;&#x4E24;&#x4E2A; goroutines &#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x7684; URL &#x5B57;&#x7B26;&#x4E32;&#x4EA4;&#x6362;&#x662F;&#x975E;&#x5E38;&#x76F4;&#x63A5;&#x7684;&#x3002;&#x7B2C;&#x4E00;&#x4E2A; goroutine &#x5411;&#x7B2C;&#x4E00;&#x4E2A;URL&#x53D1;&#x8D77;&#x4E00;&#x4E2A;Ajax&#x8BF7;&#x6C42;&#xFF0C;&#x5B83;&#x7684;&#x5E94;&#x7B54;&#x88AB;&#x653E;&#x8FDB;<code>ch</code>&#x9891;&#x9053;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A; goroutine &#x60F3;&#x7B2C;&#x4E8C;&#x4E2A;URL&#x53D1;&#x8D77;&#x4E00;&#x4E2A;Ajax&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x4ECE;<code>ch</code>&#x9891;&#x9053;&#x53D6;&#x4E0B;&#x7B2C;&#x4E00;&#x4E2A;&#x5E94;&#x7B54;<code>res1</code>&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x523B;&#xFF0C;&#x5E94;&#x7B54;<code>res1</code>&#x548C;<code>res2</code>&#x90FD;&#x88AB;&#x5B8C;&#x6210;&#x4E14;&#x51C6;&#x5907;&#x597D;&#x4E86;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5728; goroutine &#x8FD0;&#x884C;&#x7684;&#x672B;&#x5C3E;<code>ch</code>&#x9891;&#x9053;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5269;&#x4F59;&#x4EF7;&#x503C;&#x7684;&#x8BDD;&#xFF0C;&#x5B83;&#x4EEC;&#x5C06;&#x88AB;&#x4F20;&#x9012;&#x8FDB;&#x5E8F;&#x5217;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#x4E2D;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x4E3A;&#x4E86;&#x4ECE;&#x6700;&#x540E;&#x7684; goroutine &#x4E2D;&#x4F20;&#x51FA;&#x6D88;&#x606F;&#xFF0C;&#x628A;&#x5B83;&#x4EEC;<code>put(..)</code>&#x8FDB;<code>ch</code>&#x3002;&#x5C31;&#x50CF;&#x5C55;&#x793A;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x6700;&#x540E;&#x7684;&#x90A3;&#x4E9B;<code>put(..)</code>&#x963B;&#x585E;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x628A;<code>ch</code>&#x7684;<code>buffer_size</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>2</code>&#xFF08;&#x9ED8;&#x8BA4;&#x662F;<code>0</code>&#xFF09;&#x6765;&#x5C06;&#x5B83;&#x5207;&#x6362;&#x5230;&#x7F13;&#x51B2;&#x6A21;&#x5F0F;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong> &#x66F4;&#x591A;&#x4F7F;&#x7528; <em>asynquence</em> &#x98CE;&#x683C;CSP&#x7684;&#x4F8B;&#x5B50;&#x53EF;&#x4EE5;&#x53C2;&#x89C1;&#x8FD9;&#x91CC;(<a href="https://gist.github.com/getify/e0d04f1f5aa24b1947ae)&#x3002;" target="_blank">https://gist.github.com/getify/e0d04f1f5aa24b1947ae)&#x3002;</a></p>
<h2 id="&#x590D;&#x4E60;">&#x590D;&#x4E60;</h2>
<p>Promise &#x548C; generator &#x4E3A;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x521B;&#x5EFA;&#x66F4;&#x52A0;&#x7CBE;&#x5DE7;&#x548C;&#x5F3A;&#x5927;&#x7684;&#x5F02;&#x6B65;&#x6027;&#x63D0;&#x4F9B;&#x4E86;&#x57FA;&#x7840;&#x6784;&#x5EFA;&#x5757;&#x3002;</p>
<p><em>asynquence</em> &#x62E5;&#x6709;&#x8BB8;&#x591A;&#x5DE5;&#x5177;&#xFF0C;&#x7528;&#x4E8E;&#x5B9E;&#x73B0; <em>&#x7684;&#x8FED;&#x4EE3;&#x5E8F;&#x5217;</em>&#xFF0C;<em>&#x54CD;&#x5E94;&#x5F0F;&#x5E8F;&#x5217;</em>&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x201C;&#x53EF;&#x76D1;&#x542C;&#x5BF9;&#x8C61;&#x201D;&#xFF09;&#xFF0C;<em>&#x5E76;&#x53D1;&#x534F;&#x7A0B;</em>&#xFF0C;&#x751A;&#x81F3; <em>CSP goroutines</em>&#x3002;</p>
<p>&#x5C06;&#x8FD9;&#x4E9B;&#x6A21;&#x5F0F;&#xFF0C;&#x4E0E;&#x5EF6;&#x7EED;&#x56DE;&#x8C03;&#x548C; Promise &#x80FD;&#x529B;&#x76F8;&#x7EC4;&#x5408;&#xFF0C;&#x4F7F;&#x5F97; <em>asynquence</em> &#x62E5;&#x6709;&#x4E86;&#x6DF7;&#x5408;&#x4E0D;&#x540C;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7684;&#x5F3A;&#x5927;&#x529F;&#x80FD;&#xFF0C;&#x4E00;&#x5207;&#x90FD;&#x6574;&#x5408;&#x8FDB;&#x4E00;&#x4E2A;&#x5E72;&#x51C0;&#x7684;&#x5F02;&#x6B65;&#x6D41;&#x7A0B;&#x63A7;&#x5236;&#x62BD;&#x8C61;&#xFF1A;&#x5E8F;&#x5217;&#x3002;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="apA.html" class="navigation navigation-prev " aria-label="Previous page: 附录A">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="apC.html" class="navigation navigation-next " aria-label="Next page: 附录C">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"附录B","level":"1.7.10","depth":2,"next":{"title":"附录C","level":"1.7.11","depth":2,"path":"async/apC.md","ref":"async/apC.md","articles":[]},"previous":{"title":"附录A","level":"1.7.9","depth":2,"path":"async/apA.md","ref":"async/apA.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"async/apB.md","mtime":"2017-04-06T10:18:48.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-04-18T09:05:46.336Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

